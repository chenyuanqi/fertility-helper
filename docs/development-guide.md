# 备小孕小程序开发指南

## 📋 项目概述

本项目是一个备小孕微信小程序，帮助用户记录基础体温、月经经量和同房情况，并提供智能的排卵预测和可视化分析。

**第一版本特点：**
- 使用微信小程序原生框架开发
- 数据存储在微信本地存储（不使用后端API）
- JavaScript 开发，组件化架构便于维护
- 集成AI智能算法，提供专业级排卵预测

## 🎉 已完成核心功能

### 📊 数据记录系统
- **三合一记录页面**：体温、月经、同房统一记录界面
- **智能数字键盘**：专为体温输入优化的自定义键盘
- **经量滑条选择**：直观的月经量级选择组件
- **多次同房记录**：支持一天内多次记录
- **数据验证机制**：确保数据准确性和完整性

### 📈 数据可视化系统
- **三合一图表**：体温折线图 + 经量背景 + 同房标记
- **智能图表组件**：自适应缩放、横向滚动、数据点交互
- **完整日历视图**：42天月视图，多数据类型同时展示
- **日期详情面板**：点击查看详细记录信息
- **周期导航**：便捷的周期切换和时间导航

### 🤖 AI智能分析系统
- **排卵预测算法**：基于体温升高模式的科学预测
- **周期规律分析**：自动计算周期长度和规律性
- **易孕期预测**：精准的最佳受孕时机指导
- **异常检测**：自动识别体温异常和周期异常
- **个性化建议**：基于个人数据的智能健康指导
- **置信度评估**：预测结果的可信度标识

### 💾 数据管理系统
- **本地存储封装**：安全可靠的数据存储机制
- **数据同步机制**：确保数据一致性
- **缓存优化**：提升数据读取性能
- **数据完整性检查**：自动修复和验证数据

### 🎨 用户界面系统
- **现代化设计**：毛玻璃效果、渐变背景、动画交互
- **响应式布局**：适配不同屏幕尺寸
- **直观的数据展示**：颜色编码、图标标识、状态指示
- **便捷的操作流程**：30秒内完成记录的设计目标

### 📚 帮助系统
- **详细使用说明**：涵盖所有功能的使用指导
- **搜索功能**：快速查找特定功能说明
- **分类展示**：按功能模块组织的帮助内容

## 🚀 开发步骤详解

### 第一阶段：环境准备与项目初始化（预计1-2天）

#### 1.1 开发环境搭建
- [x] 下载并安装[微信开发者工具](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)
- [x] 注册微信小程序账号（前往[微信公众平台](https://mp.weixin.qq.com)）
- [x] 获取小程序 AppID
- [x] 安装 Node.js（建议 16.x 或以上版本）

#### 1.2 项目初始化
- [x] 创建小程序项目结构
- [x] 配置 TypeScript 支持
- [x] 设置代码规范（ESLint + Prettier）
- [x] 创建基础配置文件

#### 1.3 项目架构设计
- [x] 设计页面结构和路由
- [x] 设计组件架构
- [x] 设计数据存储结构
- [x] 制定编码规范

### 第二阶段：基础框架搭建（预计3-4天）

#### 2.1 页面结构创建
- [x] 创建主要页面：首页、记录页、图表页、日历页、设置页
- [x] 配置页面路由和导航
- [x] 实现底部 tabBar 导航

#### 2.2 公共组件开发
- [x] 数字键盘组件（体温输入）
- [x] 滑条组件（经量选择）
- [x] 日期选择器组件
- [x] 弹窗组件
- [x] 加载组件

#### 2.3 数据管理模块
- [x] 设计本地存储数据结构
- [x] 创建数据管理工具类
- [x] 实现数据增删改查方法
- [x] 添加数据校验和容错处理

### 第三阶段：核心功能开发（预计5-7天）

#### 3.1 数据记录功能
- [x] 体温记录页面
  - [x] 数字键盘输入体温（口腔温度）
  - [x] 时间选择（默认当前时间）
  - [x] 症状备注输入
  - [x] 数据验证和保存
  - [x] 从首页快速跳转
- [x] 经量记录功能
  - [x] 经量滑条选择（0-4级：无/少量/中等/较多/大量）
  - [x] 经期开始/结束标记
  - [x] 备注输入功能
  - [x] 从首页快速跳转
- [x] 同房记录功能
  - [x] 一键时间选择
  - [x] 避孕措施选择
  - [x] 可选备注（体位、避孕情况等）
  - [x] 支持一天多次记录
  - [x] 从首页快速跳转
- [x] 记录页面统一界面
  - [x] 三种记录类型切换
  - [x] 今日记录预览
  - [x] 记录删除功能
  - [x] 响应式设计

#### 3.2 数据存储与管理
- [x] 实现微信本地存储封装
  - [x] StorageManager 通用存储类
  - [x] FertilityStorage 业务存储封装
  - [x] 存储键名统一管理
- [x] 数据同步机制（保证数据一致性）
  - [x] DataManager 单例模式
  - [x] 缓存机制实现
  - [x] 数据版本管理
- [x] 数据备份与恢复功能
  - [x] 数据导出接口设计
  - [x] 数据导入验证机制
- [x] 历史数据清理机制
  - [x] 自动清理过期数据
  - [x] 数据保留策略配置

### 第四阶段：数据可视化开发（预计4-5天）

#### 4.1 三合一图表组件
- [x] 体温折线图
  - [x] 数据点展示
  - [x] hover 交互效果
  - [x] 温度刻度显示
- [x] 经量背景区块
  - [x] 渐变色彩显示
  - [x] 经期时间范围标记
- [x] 同房图标叠加
  - [x] 不同状态图标设计
  - [x] 多次记录数字叠加

#### 4.2 辅助功能
- [x] cover-line 自动绘制
  - [x] 基于体温升高模式计算覆盖线
  - [x] 动态温度阈值显示
  - [x] 覆盖线位置自适应标注
- [x] 排卵日预测标记
  - [x] 基于cover-line位移预测排卵日
  - [x] 置信度级别显示（高/中/低）
  - [x] 可视化排卵标记和提示信息
- [x] 图表缩放和平移
  - [x] 双状态缩放切换（正常/放大）
  - [x] 智能宽度计算（基于数据量）
  - [x] 横向滚动查看和自动定位最新数据
- [x] 周期切换功能
  - [x] 上一周期/下一周期导航
  - [x] 快速回到当前周期（"今"按钮）
  - [x] 智能边界检查和用户提示

#### 4.3 日历视图
- [x] 月视图日历组件
  - [x] 完整的月份网格布局和日期渲染
  - [x] 支持跨月显示（上月末尾/下月开头）
  - [x] 今日高亮显示和选中状态
  - [x] 月份导航（上一月/下一月/回到今天）
- [x] 每日数据摘要显示
  - [x] 体温指示器（普通/高温不同颜色）
  - [x] 经期背景色（轻度/中度/重度）
  - [x] 同房标记和次数显示
  - [x] 多种数据类型同时展示
- [x] 快速跳转到具体日期
  - [x] 点击日期查看详细信息
  - [x] 无数据日期提示添加记录
  - [x] 支持跨月份导航
  - [x] 与图表视图无缝切换

### 第四.五阶段：独立日历页面开发（实际完成）

#### 4.5 完整日历页面实现
- [x] 独立日历页面架构设计
  - [x] 基于原型设计的完整页面布局
  - [x] 数据加载和状态管理
  - [x] 页面生命周期管理
  - [x] 下拉刷新功能集成
- [x] 日历头部信息区域
  - [x] 月份导航控制（上一月/下一月/回到今天）
  - [x] 统计数据显示（周期天数/记录天数/预计排卵）
  - [x] 动态数据计算和更新
- [x] 日历网格完整实现
  - [x] 42天完整月视图（6周×7天）
  - [x] 跨月数据支持和显示
  - [x] 多种数据指示器（体温/经期/同房/症状）
  - [x] 今日高亮和选中状态
  - [x] 经期背景渐变效果
- [x] 日期详情面板
  - [x] 点击日期展示详细信息
  - [x] 四种数据类型卡片展示
  - [x] 症状备注详细显示
  - [x] 编辑按钮跳转记录页面
  - [x] 收起面板交互功能
- [x] 完整视觉设计实现
  - [x] 符合原型的UI设计
  - [x] 响应式布局适配
  - [x] 动画效果和交互反馈
  - [x] 图例说明完整展示

### 第五阶段：智能算法集成（预计3-4天）
### 第五阶段：智能算法集成（预计3-4天）✅

#### 5.1 排卵预测算法
- [x] 基础体温分析算法
  - [x] 移动平均线计算（3天窗口）
  - [x] 体温升高模式检测
  - [x] 覆盖线自动计算
  - [x] 置信度评估（高/中/低）
- [x] 月经周期规律分析
  - [x] 平均周期长度计算
  - [x] 周期变异性分析
  - [x] 规律性评估算法
  - [x] 下次月经预测
- [x] 排卵窗口计算
  - [x] 基于体温数据的排卵预测
  - [x] 基于周期数据的排卵预测
  - [x] 综合预测算法
  - [x] 排卵窗口范围计算
- [x] 易孕期预测
  - [x] 最佳受孕期计算
  - [x] 易孕期窗口确定
  - [x] 当前状态实时判断
  - [x] 个性化建议生成

#### 5.2 数据分析功能
- [x] 周期统计分析
  - [x] 体温统计数据分析
  - [x] 月经统计数据分析
  - [x] 同房统计数据分析
  - [x] 数据完整性评估
- [x] 趋势分析
  - [x] 体温趋势分析（30天）
  - [x] 记录频率趋势分析
  - [x] 周期变化趋势分析
  - [x] 线性回归趋势计算
- [x] 异常数据检测
  - [x] 体温异常检测（过高/过低/突变）
  - [x] 周期异常检测（过长/过短）
  - [x] 数据缺口检测
  - [x] 异常处理建议生成
- [x] 健康建议生成
  - [x] 基于数据质量的建议
  - [x] 基于趋势分析的建议
  - [x] 基于异常检测的建议
  - [x] 个性化健康指导

#### 5.3 智能分析界面集成
- [x] 首页智能分析卡片
  - [x] 易孕期状态实时显示
  - [x] 置信度标识系统
  - [x] 智能建议展示
  - [x] 一键跳转详细分析
- [x] 数据不足提示系统
  - [x] AI助手等待状态
  - [x] 数据需求指导
  - [x] 记录建议提示
- [x] 视觉设计优化
  - [x] 置信度颜色编码
  - [x] 渐变背景设计
  - [x] 动画效果增强
  - [x] 响应式布局适配

### 第六阶段：用户体验优化（预计2-3天）

#### 6.1 提醒功能
- [x] 晨起测温提醒
  - [x] ReminderManager 提醒管理器
  - [x] 自定义提醒时间设置
  - [x] 开启/关闭提醒开关
  - [x] 提醒状态持久化存储
- [x] 易孕期提醒
  - [x] 基于排卵预测的易孕期提醒
  - [x] 智能提醒时机计算
  - [x] 提醒开关控制
- [x] 排卵窗口提醒
  - [x] 排卵日预测提醒
  - [x] 排卵窗口期提醒
  - [x] 提醒开关控制
- [x] 自定义提醒设置
  - [x] 个性化提醒时间设置
  - [x] 提醒功能测试
  - [x] 提醒状态管理和重置

#### 6.2 导出功能
- [x] 数据导出功能
  - [x] 完整数据JSON导出
  - [x] 包含用户设置、日记录、周期数据
  - [x] 导出文件命名和时间戳
  - [x] 多种分享方式（文件分享/复制到剪贴板）
- [x] 数据导入功能
  - [x] 从聊天记录选择文件导入
  - [x] 从剪贴板导入数据
  - [x] 数据格式验证和错误处理
  - [x] 导入预览和确认机制
- [x] 周期报告生成（已修复）
  - [x] ReportGenerator 报告生成器
  - [x] 文本格式报告生成
  - [x] JSON格式详细报告生成
  - [x] 多种报告选项（3/6/全部周期）
  - [x] 报告内容包含：
    - [x] 数据摘要统计
    - [x] 周期分析详情
    - [x] 体温分析模式
    - [x] 生育力状态评估
    - [x] 数据质量评分
    - [x] 个性化健康建议
  - [x] 报告分享功能
    - [x] 复制到剪贴板
    - [x] 文件分享
    - [x] 报告导出
  - [x] 设置页面集成
  - [x] 独立报告页面
  - [x] 错误处理和数据验证

#### 6.3 界面优化
- [x] 响应式布局适配
  - [x] 所有页面支持不同屏幕尺寸
  - [x] 组件自适应布局设计
  - [x] 图表组件响应式缩放
  - [x] 日历组件自适应网格
- [x] 动画效果添加
  - [x] 页面切换动画
  - [x] 卡片展开/收起动画
  - [x] 数据加载动画
  - [x] 按钮点击反馈动画
  - [x] 图表数据点交互动画
- [x] 加载状态优化
  - [x] 数据加载Loading组件
  - [x] 图表渲染加载状态
  - [x] 页面初始化加载提示
  - [x] 异步操作加载反馈
- [x] 错误提示优化
  - [x] 统一的错误提示样式
  - [x] 网络错误处理
  - [x] 数据验证错误提示
  - [x] 用户操作错误引导

#### 6.4 用户体验增强
- [x] 使用说明页面
  - [x] 详细的功能使用指导
  - [x] 搜索功能快速查找
  - [x] 分类展示便于浏览
  - [x] 展开/收起交互优化
- [x] 数据可视化优化
  - [x] 图表纵向网格线添加
  - [x] 日期格式优化（MMDD格式）
  - [x] 月经和同房标记位置优化
  - [x] 图表显示密度智能调整
- [x] 交互体验优化
  - [x] 30秒内完成记录的设计目标
  - [x] 一键快速记录功能
  - [x] 智能默认值设置
  - [x] 操作流程简化
- [x] 视觉设计优化
  - [x] 毛玻璃效果背景
  - [x] 渐变色彩搭配
  - [x] 图标和颜色编码统一
  - [x] 卡片式设计语言

#### 6.5 设置页面完善
- [x] 个人资料管理
  - [x] 头像上传和编辑功能
  - [x] 昵称设置
  - [x] 个人信息统计展示
- [x] 个人信息设置
  - [x] 平均周期长度设置
  - [x] 黄体期长度设置
  - [x] 数据验证和范围检查
- [x] 数据管理功能
  - [x] 数据统计卡片展示
  - [x] 数据导出/导入功能
  - [x] 数据清空功能（危险操作）
  - [x] 完整的确认和安全机制
- [x] 应用设置
  - [x] 版本信息显示
  - [x] 隐私政策说明
  - [x] 联系我们功能
  - [x] 使用帮助跳转

### 第七阶段：测试与优化（预计2-3天）

#### 7.1 功能测试
- [x] 单元测试编写
- [x] 集成测试
- [x] 用户体验测试
- [x] 边界条件测试

#### 7.2 性能优化
- [x] 代码分包加载
- [x] 图片资源优化
- [x] 数据加载优化
- [x] 内存使用优化

#### 7.3 兼容性测试
- [ ] 不同设备适配测试
- [ ] 微信版本兼容性测试
- [ ] 操作系统兼容性测试

### 第八阶段：发布准备（预计1-2天）

#### 8.1 发布前检查
- [ ] 代码审查
- [ ] 文档完善
- [ ] 用户隐私协议
- [ ] 小程序信息完善

#### 8.2 提交审核
- [ ] 准备审核资料
- [ ] 提交微信审核
- [ ] 响应审核反馈
- [ ] 发布上线

## 🛠️ 技术选型

### 前端技术栈
- **框架**: 微信小程序原生框架
- **语言**: TypeScript
- **UI组件**: 原生组件 + 自定义组件
- **图表库**: ECharts for 小程序
- **状态管理**: 原生数据绑定 + 本地存储

### 开发工具
- **IDE**: 微信开发者工具
- **代码规范**: ESLint + Prettier
- **版本控制**: Git
- **文档**: Markdown

## 📱 项目结构

```
fertility-helper/
├── docs/                    # 项目文档
├── miniprogram/            # 小程序源码
│   ├── pages/              # 页面文件
│   │   ├── index/          # 首页
│   │   ├── record/         # 记录页
│   │   ├── chart/          # 图表页
│   │   ├── calendar/       # 日历页
│   │   └── settings/       # 设置页
│   ├── components/         # 自定义组件
│   │   ├── keyboard/       # 数字键盘
│   │   ├── slider/         # 滑条组件
│   │   ├── chart/          # 图表组件
│   │   └── calendar/       # 日历组件
│   ├── utils/              # 工具函数
│   ├── utils/              # 工具函数
│   │   ├── storage.js      # 存储管理
│   │   ├── ovulationAlgorithm.js  # 排卵预测算法
│   │   ├── dataAnalysis.js # 数据分析功能
│   │   ├── date.js         # 日期处理
│   │   └── validator.js    # 数据验证
│   ├── types/              # TypeScript 类型定义
│   ├── styles/             # 样式文件
│   ├── app.ts              # 应用入口
│   ├── app.json            # 应用配置
│   └── app.wxss            # 全局样式
├── project.config.json     # 项目配置
├── tsconfig.json          # TypeScript 配置
└── README.md              # 项目说明
```

## 🎯 里程碑计划

| 里程碑 | 预计完成时间 | 主要交付物 | 状态 |
|--------|-------------|-----------|------|
| M1 | 第1-2天 | 项目环境搭建完成，基础架构确定 | ✅ 已完成 |
| M2 | 第3-6天 | 页面框架和基础组件开发完成 | ✅ 已完成 |
| M3 | 第7-13天 | 核心记录功能开发完成 | ✅ 已完成 |
| M4 | 第14-18天 | 数据可视化功能开发完成 | ✅ 已完成 |
| M4.5 | 实际增加 | 独立日历页面开发完成 | ✅ 已完成 |
| M5 | 第19-22天 | 智能算法集成完成 | ✅ 已完成 |
| M6 | 第23-25天 | 用户体验优化完成 | ✅ 已完成 |
| M7 | 第26-28天 | 测试和优化完成 | ⏳ 待开始 |
| M8 | 第29-30天 | 发布准备完成，提交审核 | ⏳ 待开始 |

## ⚠️ 重要注意事项

1. **数据隐私**: 虽然数据存储在本地，但仍需遵守微信小程序隐私政策
2. **用户体验**: 确保30秒内完成记录的设计目标
3. **数据备份**: 提供数据导出功能，防止用户数据丢失
4. **算法准确性**: 排卵预测算法需要经过充分测试
5. **兼容性**: 确保在不同设备和微信版本上正常运行

## 📚 学习资源

- [微信小程序官方文档](https://developers.weixin.qq.com/miniprogram/dev/framework/)
- [TypeScript 官方文档](https://www.typescriptlang.org/docs/)
- [ECharts 小程序版本](https://github.com/ecomfe/echarts-for-weixin)
- [小程序设计指南](https://developers.weixin.qq.com/miniprogram/design/)

这个开发指南将帮助您系统性地完成备小孕小程序的开发。建议按照步骤逐步推进，确保每个阶段的质量后再进入下一阶段。 