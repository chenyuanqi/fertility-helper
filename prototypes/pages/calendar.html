<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¤‡å°å­• - æ—¥å†</title>
  <link rel="stylesheet" href="../assets/css/common.css">
  <style>
    /* æ—¥å†é¡µé¢ç‰¹æœ‰æ ·å¼ */
    .calendar-header {
      background: var(--surface);
      border-radius: var(--border-radius);
      padding: 16px;
      margin-bottom: var(--section-margin);
      box-shadow: var(--shadow-small);
    }
    
    .month-navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .month-year {
      font-size: 20px;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .month-nav-btn {
      width: 36px;
      height: 36px;
      border: none;
      border-radius: 50%;
      background: var(--background);
      color: var(--text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }
    
    .month-nav-btn:hover {
      background: var(--border);
    }
    
    .calendar-info {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
    }
    
    .info-item {
      text-align: center;
    }
    
    .info-value {
      font-size: 18px;
      font-weight: 600;
      color: var(--primary-color);
      margin-bottom: 4px;
    }
    
    .info-label {
      font-size: 12px;
      color: var(--text-secondary);
    }
    
    /* æ—¥å†ç½‘æ ¼ */
    .calendar-container {
      background: var(--surface);
      border-radius: var(--border-radius);
      padding: 16px;
      margin-bottom: var(--section-margin);
      box-shadow: var(--shadow-small);
    }
    
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 1px;
      background: var(--border);
      border-radius: var(--border-radius-small);
      overflow: hidden;
    }
    
    .weekday-header {
      background: var(--background);
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
    }
    
    .calendar-day {
      background: var(--surface);
      height: 80px;
      position: relative;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .calendar-day:hover {
      background: var(--background);
    }
    
    .calendar-day.other-month {
      opacity: 0.3;
    }
    
    .calendar-day.today {
      background: var(--primary-light);
      color: white;
    }
    
    .calendar-day.selected {
      background: var(--primary-color);
      color: white;
    }
    
    .calendar-day.menstruation {
      background: linear-gradient(to bottom, var(--surface) 0%, var(--menstruation-light) 100%);
    }
    
    .calendar-day.ovulation {
      background: linear-gradient(to bottom, var(--surface) 0%, var(--ovulation-day) 100%);
    }
    
    .day-number {
      position: absolute;
      top: 4px;
      left: 6px;
      font-size: 14px;
      font-weight: 500;
    }
    
    .day-indicators {
      position: absolute;
      bottom: 4px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 2px;
    }
    
    .indicator {
      width: 6px;
      height: 6px;
      border-radius: 50%;
    }
    
    .indicator.temperature {
      background: var(--primary-color);
    }
    
    .indicator.menstruation {
      background: var(--menstruation-medium);
    }
    
    .indicator.intimacy {
      background: var(--secondary-color);
    }
    
    .indicator.symptoms {
      background: var(--warning-color);
    }
    
    /* é€‰ä¸­æ—¥æœŸè¯¦æƒ… */
    .selected-day-details {
      background: var(--surface);
      border-radius: var(--border-radius);
      padding: 20px;
      margin-bottom: var(--section-margin);
      box-shadow: var(--shadow-small);
      display: none;
    }
    
    .selected-day-details.show {
      display: block;
    }
    
    .details-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .selected-date {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .edit-btn {
      padding: 6px 12px;
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: var(--border-radius-small);
      font-size: 12px;
      cursor: pointer;
    }
    
    .details-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }
    
    .detail-card {
      background: var(--background);
      border-radius: var(--border-radius-small);
      padding: 12px;
    }
    
    .detail-icon {
      font-size: 20px;
      margin-bottom: 8px;
    }
    
    .detail-title {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }
    
    .detail-value {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .detail-value.empty {
      color: var(--text-disabled);
      font-weight: normal;
    }
    
    .detail-notes {
      grid-column: 1 / -1;
      margin-top: 8px;
    }
    
    .notes-content {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.5;
      padding: 8px;
      background: var(--surface);
      border-radius: var(--border-radius-small);
    }
    
    /* å›¾ä¾‹ */
    .calendar-legend {
      background: var(--surface);
      border-radius: var(--border-radius);
      padding: 16px;
      box-shadow: var(--shadow-small);
    }
    
    .legend-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 12px;
    }
    
    .legend-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: var(--text-secondary);
    }
    
    .legend-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }
    
    .legend-dot.temperature {
      background: var(--primary-color);
    }
    
    .legend-dot.menstruation {
      background: var(--menstruation-medium);
    }
    
    .legend-dot.intimacy {
      background: var(--secondary-color);
    }
    
    .legend-dot.symptoms {
      background: var(--warning-color);
    }
  </style>
</head>
<body>
  <div class="mobile-container">
    <div class="page-container">
      <h1 class="page-title">æ—¥å†è§†å›¾</h1>
      
      <!-- æ—¥å†å¤´éƒ¨ä¿¡æ¯ -->
      <div class="calendar-header">
        <div class="month-navigation">
          <button class="month-nav-btn" onclick="previousMonth()">â€¹</button>
          <div class="month-year" id="monthYear">2024å¹´1æœˆ</div>
          <button class="month-nav-btn" onclick="nextMonth()">â€º</button>
        </div>
        
        <div class="calendar-info">
          <div class="info-item">
            <div class="info-value">15</div>
            <div class="info-label">å‘¨æœŸç¬¬å‡ å¤©</div>
          </div>
          <div class="info-item">
            <div class="info-value">12</div>
            <div class="info-label">è®°å½•å¤©æ•°</div>
          </div>
          <div class="info-item">
            <div class="info-value">1æœˆ24æ—¥</div>
            <div class="info-label">é¢„è®¡æ’åµ</div>
          </div>
        </div>
      </div>

      <!-- æ—¥å†ç½‘æ ¼ -->
      <div class="calendar-container">
        <div class="calendar-grid" id="calendarGrid">
          <!-- æ˜ŸæœŸæ ‡é¢˜ -->
          <div class="weekday-header">æ—¥</div>
          <div class="weekday-header">ä¸€</div>
          <div class="weekday-header">äºŒ</div>
          <div class="weekday-header">ä¸‰</div>
          <div class="weekday-header">å››</div>
          <div class="weekday-header">äº”</div>
          <div class="weekday-header">å…­</div>
          
          <!-- æ—¥æœŸæ ¼å­ - è¿™é‡Œç”¨JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
      </div>

      <!-- é€‰ä¸­æ—¥æœŸè¯¦æƒ… -->
      <div class="selected-day-details" id="dayDetails">
        <div class="details-header">
          <div class="selected-date" id="selectedDateText">1æœˆ15æ—¥ å‘¨ä¸€</div>
          <button class="edit-btn" onclick="editSelectedDay()">ç¼–è¾‘</button>
        </div>
        
        <div class="details-grid">
          <div class="detail-card">
            <div class="detail-icon">ğŸŒ¡ï¸</div>
            <div class="detail-title">åŸºç¡€ä½“æ¸©</div>
            <div class="detail-value" id="detailTemperature">36.5Â°C</div>
          </div>
          
          <div class="detail-card">
            <div class="detail-icon">ğŸ©¸</div>
            <div class="detail-title">æœˆç»ç»é‡</div>
            <div class="detail-value" id="detailMenstruation">æ— </div>
          </div>
          
          <div class="detail-card">
            <div class="detail-icon">ğŸ’•</div>
            <div class="detail-title">åŒæˆ¿è®°å½•</div>
            <div class="detail-value" id="detailIntimacy">1æ¬¡</div>
          </div>
          
          <div class="detail-card">
            <div class="detail-icon">ğŸ“</div>
            <div class="detail-title">ç—‡çŠ¶å¤‡æ³¨</div>
            <div class="detail-value" id="detailSymptoms">æ­£å¸¸</div>
          </div>
          
          <div class="detail-notes">
            <div class="detail-title">è¯¦ç»†å¤‡æ³¨</div>
            <div class="notes-content" id="detailNotes">
              ä»Šæ—¥æ„Ÿè§‰è‰¯å¥½ï¼Œä½“æ¸©ç¨³å®šã€‚æ™šä¸Š22:00åŒæˆ¿ï¼Œæ— å…¶ä»–ç‰¹æ®Šç—‡çŠ¶ã€‚
            </div>
          </div>
        </div>
      </div>

      <!-- å›¾ä¾‹è¯´æ˜ -->
      <div class="calendar-legend">
        <div class="legend-title">å›¾ä¾‹è¯´æ˜</div>
        <div class="legend-grid">
          <div class="legend-item">
            <div class="legend-dot temperature"></div>
            <span>åŸºç¡€ä½“æ¸©</span>
          </div>
          <div class="legend-item">
            <div class="legend-dot menstruation"></div>
            <span>æœˆç»è®°å½•</span>
          </div>
          <div class="legend-item">
            <div class="legend-dot intimacy"></div>
            <span>åŒæˆ¿è®°å½•</span>
          </div>
          <div class="legend-item">
            <div class="legend-dot symptoms"></div>
            <span>ç—‡çŠ¶å¤‡æ³¨</span>
          </div>
          <div class="legend-item">
            <div style="width:12px;height:12px;background:var(--primary-light);border-radius:2px;"></div>
            <span>ä»Šå¤©</span>
          </div>
          <div class="legend-item">
            <div style="width:12px;height:12px;background:var(--ovulation-day);border-radius:2px;"></div>
            <span>æ’åµæœŸ</span>
          </div>
        </div>
      </div>
    </div>

    <!-- TabBar å¯¼èˆª -->
    <div class="tabbar">
      <a href="index.html" class="tab-item" data-page="index">
        <div class="tab-icon">ğŸ </div>
        <div>é¦–é¡µ</div>
      </a>
      <a href="record.html" class="tab-item" data-page="record">
        <div class="tab-icon">ğŸ“</div>
        <div>è®°å½•</div>
      </a>
      <a href="chart.html" class="tab-item" data-page="chart">
        <div class="tab-icon">ğŸ“Š</div>
        <div>å›¾è¡¨</div>
      </a>
      <a href="calendar.html" class="tab-item active" data-page="calendar">
        <div class="tab-icon">ğŸ“…</div>
        <div>æ—¥å†</div>
      </a>
      <a href="settings.html" class="tab-item" data-page="settings">
        <div class="tab-icon">âš™ï¸</div>
        <div>è®¾ç½®</div>
      </a>
    </div>
  </div>

  <script src="../assets/js/common.js"></script>
  <script>
    let currentDate = new Date(2024, 0, 1); // 2024å¹´1æœˆ
    let selectedDay = null;

    // æ¨¡æ‹Ÿæ•°æ®
    const calendarData = {
      '2024-01-10': { temperature: 36.3, menstruation: 'medium', intimacy: 0, symptoms: '' },
      '2024-01-11': { temperature: 36.4, menstruation: 'light', intimacy: 0, symptoms: '' },
      '2024-01-12': { temperature: 36.5, menstruation: 'none', intimacy: 1, symptoms: 'è½»å¾®è…¹ç—›' },
      '2024-01-13': { temperature: 36.6, menstruation: 'none', intimacy: 0, symptoms: '' },
      '2024-01-14': { temperature: 36.8, menstruation: 'none', intimacy: 1, symptoms: '' },
      '2024-01-15': { temperature: 36.5, menstruation: 'none', intimacy: 1, symptoms: 'æ­£å¸¸' },
      '2024-01-16': { temperature: 36.9, menstruation: 'none', intimacy: 0, symptoms: '' },
      '2024-01-17': { temperature: 37.0, menstruation: 'none', intimacy: 0, symptoms: '' },
      '2024-01-18': { temperature: 36.8, menstruation: 'none', intimacy: 1, symptoms: '' },
    };

    document.addEventListener('DOMContentLoaded', function() {
      generateCalendar();
    });

    function generateCalendar() {
      const grid = document.getElementById('calendarGrid');
      const monthYear = document.getElementById('monthYear');
      
      // æ›´æ–°æœˆä»½æ˜¾ç¤º
      monthYear.textContent = `${currentDate.getFullYear()}å¹´${currentDate.getMonth() + 1}æœˆ`;
      
      // æ¸…é™¤ç°æœ‰å†…å®¹ï¼ˆä¿ç•™æ˜ŸæœŸæ ‡é¢˜ï¼‰
      const weekHeaders = grid.querySelectorAll('.weekday-header');
      grid.innerHTML = '';
      weekHeaders.forEach(header => grid.appendChild(header));
      
      // è·å–æœˆä»½ä¿¡æ¯
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const startDate = new Date(firstDay);
      startDate.setDate(startDate.getDate() - firstDay.getDay());
      
      // ç”Ÿæˆæ—¥æœŸæ ¼å­
      for (let i = 0; i < 42; i++) {
        const date = new Date(startDate);
        date.setDate(startDate.getDate() + i);
        
        const dayElement = createDayElement(date, month);
        grid.appendChild(dayElement);
      }
    }

    function createDayElement(date, currentMonth) {
      const dayElement = document.createElement('div');
      dayElement.className = 'calendar-day';
      
      const dayNumber = document.createElement('div');
      dayNumber.className = 'day-number';
      dayNumber.textContent = date.getDate();
      
      // åˆ¤æ–­æ˜¯å¦æ˜¯å…¶ä»–æœˆä»½
      if (date.getMonth() !== currentMonth) {
        dayElement.classList.add('other-month');
      }
      
      // åˆ¤æ–­æ˜¯å¦æ˜¯ä»Šå¤©
      const today = new Date();
      if (date.toDateString() === today.toDateString()) {
        dayElement.classList.add('today');
      }
      
      // è·å–è¯¥æ—¥æœŸçš„æ•°æ®
      const dateString = DateUtils.format(date);
      const dayData = calendarData[dateString];
      
      if (dayData) {
        // æ·»åŠ èƒŒæ™¯æ ·å¼
        if (dayData.menstruation !== 'none') {
          dayElement.classList.add('menstruation');
        }
        
        // åˆ›å»ºæŒ‡ç¤ºå™¨
        const indicators = document.createElement('div');
        indicators.className = 'day-indicators';
        
        if (dayData.temperature) {
          const tempIndicator = document.createElement('div');
          tempIndicator.className = 'indicator temperature';
          indicators.appendChild(tempIndicator);
        }
        
        if (dayData.menstruation !== 'none') {
          const menIndicator = document.createElement('div');
          menIndicator.className = 'indicator menstruation';
          indicators.appendChild(menIndicator);
        }
        
        if (dayData.intimacy > 0) {
          const intimacyIndicator = document.createElement('div');
          intimacyIndicator.className = 'indicator intimacy';
          indicators.appendChild(intimacyIndicator);
        }
        
        if (dayData.symptoms) {
          const symptomsIndicator = document.createElement('div');
          symptomsIndicator.className = 'indicator symptoms';
          indicators.appendChild(symptomsIndicator);
        }
        
        dayElement.appendChild(indicators);
      }
      
      dayElement.appendChild(dayNumber);
      
      // æ·»åŠ ç‚¹å‡»äº‹ä»¶
      dayElement.onclick = function() {
        selectDay(dayElement, date, dayData);
      };
      
      return dayElement;
    }

    function selectDay(element, date, data) {
      // ç§»é™¤ä¹‹å‰é€‰ä¸­çš„æ ·å¼
      if (selectedDay) {
        selectedDay.classList.remove('selected');
      }
      
      // é€‰ä¸­å½“å‰æ—¥æœŸ
      element.classList.add('selected');
      selectedDay = element;
      
      // æ˜¾ç¤ºè¯¦æƒ…
      showDayDetails(date, data);
    }

    function showDayDetails(date, data) {
      const details = document.getElementById('dayDetails');
      const selectedDateText = document.getElementById('selectedDateText');
      
      // æ›´æ–°æ—¥æœŸæ˜¾ç¤º
      const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
      const month = date.getMonth() + 1;
      const day = date.getDate();
      const weekday = weekdays[date.getDay()];
      selectedDateText.textContent = `${month}æœˆ${day}æ—¥ å‘¨${weekday}`;
      
      // æ›´æ–°è¯¦ç»†ä¿¡æ¯
      if (data) {
        document.getElementById('detailTemperature').textContent = 
          data.temperature ? `${data.temperature}Â°C` : 'æœªè®°å½•';
        document.getElementById('detailTemperature').className = 
          data.temperature ? 'detail-value' : 'detail-value empty';
        
        const flowMap = { 'none': 'æ— ', 'light': 'å°‘é‡', 'medium': 'ä¸­é‡', 'heavy': 'å¤§é‡' };
        document.getElementById('detailMenstruation').textContent = flowMap[data.menstruation] || 'æ— ';
        document.getElementById('detailMenstruation').className = 
          data.menstruation !== 'none' ? 'detail-value' : 'detail-value empty';
        
        document.getElementById('detailIntimacy').textContent = 
          data.intimacy > 0 ? `${data.intimacy}æ¬¡` : 'æ— ';
        document.getElementById('detailIntimacy').className = 
          data.intimacy > 0 ? 'detail-value' : 'detail-value empty';
        
        document.getElementById('detailSymptoms').textContent = data.symptoms || 'æ— ';
        document.getElementById('detailSymptoms').className = 
          data.symptoms ? 'detail-value' : 'detail-value empty';
        
        document.getElementById('detailNotes').textContent = 
          data.symptoms ? `ç—‡çŠ¶: ${data.symptoms}` : 'æš‚æ— å¤‡æ³¨';
      } else {
        // æ²¡æœ‰æ•°æ®çš„æƒ…å†µ
        document.getElementById('detailTemperature').textContent = 'æœªè®°å½•';
        document.getElementById('detailTemperature').className = 'detail-value empty';
        document.getElementById('detailMenstruation').textContent = 'æ— ';
        document.getElementById('detailMenstruation').className = 'detail-value empty';
        document.getElementById('detailIntimacy').textContent = 'æ— ';
        document.getElementById('detailIntimacy').className = 'detail-value empty';
        document.getElementById('detailSymptoms').textContent = 'æ— ';
        document.getElementById('detailSymptoms').className = 'detail-value empty';
        document.getElementById('detailNotes').textContent = 'æš‚æ— è®°å½•';
      }
      
      // æ˜¾ç¤ºè¯¦æƒ…é¢æ¿
      details.classList.add('show');
      details.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // æœˆä»½å¯¼èˆª
    function previousMonth() {
      currentDate.setMonth(currentDate.getMonth() - 1);
      generateCalendar();
      hideDayDetails();
    }

    function nextMonth() {
      currentDate.setMonth(currentDate.getMonth() + 1);
      generateCalendar();
      hideDayDetails();
    }

    function hideDayDetails() {
      const details = document.getElementById('dayDetails');
      details.classList.remove('show');
      
      if (selectedDay) {
        selectedDay.classList.remove('selected');
        selectedDay = null;
      }
    }

    // ç¼–è¾‘é€‰ä¸­æ—¥æœŸ
    function editSelectedDay() {
      if (selectedDay) {
        Toast.success('è·³è½¬åˆ°è®°å½•é¡µé¢');
        setTimeout(() => {
          window.location.href = 'record.html';
        }, 500);
      }
    }
  </script>
</body>
</html> 