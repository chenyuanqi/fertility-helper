<!--components/chart/chart.wxml-->
<!--components/chart/chart.wxml-->
<view class="chart-container" style="width: {{width}}rpx; height: {{height}}rpx;">
  <!-- 数据为空的状态 -->
  <view wx:if="{{!processedData || processedData.length === 0}}" class="chart-empty">
    <text class="empty-text">暂无数据</text>
  </view>
  
  <!-- 三合一图表显示 -->
  <view wx:else class="chart-content">
    <!-- Y轴标签 -->
    <view class="y-axis">
      <view class="y-label">37.5</view>
      <view class="y-label">37.0</view>
      <view class="y-label">36.5</view>
      <view class="y-label">36.0</view>
      <view class="y-label">35.5</view>
    </view>
    
    <!-- X轴标签 -->
    <!-- X轴标签 -->
    <!-- X轴标签 -->
    <view class="x-axis">
      <view wx:for="{{displayIndexes}}" wx:key="*this" 
            class="x-label"
            style="left: {{(item / (processedData.length - 1)) * 100}}%;">
        {{processedData[item].dateDisplay}}
      </view>
    </view>
    
    <!-- 图表内容区域 -->
    <view class="chart-content-area">
      <!-- 经量背景 -->
      <view wx:if="{{viewMode === 'all'}}" class="menstrual-backgrounds">
        <view wx:for="{{processedData}}" wx:key="index" 
              class="menstrual-bg menstrual-level-{{item.menstrualLevel || 0}}"
              wx:if="{{item.hasMenstrual}}"
              style="left: {{(index / (processedData.length - 1)) * 100}}%; width: {{100 / processedData.length}}%;">
        </view>
      </view>
      
      <!-- Cover-line 覆盖线 -->
      <view wx:if="{{coverLine && (viewMode === 'all' || viewMode === 'temperature')}}" 
            class="cover-line"
            style="bottom: {{coverLine.percent}}%;">
      </view>
      
      <!-- 体温线和点 -->
      <view class="temperature-layer">
        <!-- 体温点 -->
        <view wx:for="{{processedData}}" wx:key="index" 
              wx:if="{{item.hasTemperature}}"
              class="temperature-point {{item.isHighTemp ? 'high-temp' : ''}} {{item.isAboveCoverLine ? 'above-coverline' : ''}}"
              style="left: {{(index / (processedData.length - 1)) * 100}}%; bottom: {{item.temperaturePercent}}%;"
              bindtap="onPointClick"
              data-index="{{index}}">
        </view>
      </view>
      
      <!-- 同房标记 -->
      <view wx:if="{{viewMode === 'all'}}" class="intercourse-markers">
        <view wx:for="{{processedData}}" wx:key="index" 
              wx:if="{{item.hasIntercourse}}"
              class="intercourse-marker"
              style="left: {{(index / (processedData.length - 1)) * 100}}%;">
            <text class="marker-icon" style="color: #8e44ad;">●</text>
          <text wx:if="{{item.intercourseCount > 1}}" class="marker-count">{{item.intercourseCount}}</text>
        </view>
      </view>
      
      <!-- 排卵日标记 -->
      <view wx:if="{{ovulationPrediction && (viewMode === 'all' || viewMode === 'temperature')}}" class="ovulation-markers">
        <view wx:for="{{processedData}}" wx:key="index" 
              wx:if="{{item.isOvulationDay}}"
              class="ovulation-marker confidence-{{ovulationPrediction.confidence}}"
              style="left: {{(index / (processedData.length - 1)) * 100}}%;">
          <text class="ovulation-icon">O</text>
        </view>
      </view>
    </view>
  </view>
</view>
