<!--components/chart/chart.wxml-->
<view class="chart-container" style="width: {{width}}px; height: {{height}}px;">
  <!-- æ•°æ®ä¸ºç©ºçš„çŠ¶æ€ -->
  <view wx:if="{{!processedData || processedData.length === 0}}" class="chart-empty">
    <text class="empty-text">æš‚æ— æ•°æ®</text>
  </view>
  
  <!-- ç®€åŒ–å›¾è¡¨æ˜¾ç¤º -->
  <view wx:else class="chart-content">
    <!-- Yè½´æ ‡ç­¾ -->
    <view class="y-axis">
      <view class="y-label">37.5</view>
      <view class="y-label">37.0</view>
      <view class="y-label">36.5</view>
      <view class="y-label">36.0</view>
      <view class="y-label">35.5</view>
    </view>
    
    <!-- å›¾è¡¨åŒºåŸŸ -->
    <view class="chart-area">
      <!-- ç½‘æ ¼çº¿ -->
      <view class="grid-lines">
        <view class="grid-line horizontal" wx:for="{{[0,1,2,3,4]}}" wx:key="*this" style="top: {{item * 25}}%;"></view>
      </view>
      
      <!-- ç»é‡èƒŒæ™¯ -->
      <view wx:if="{{viewMode === 'all'}}" class="menstrual-backgrounds">
        <view wx:for="{{processedData}}" wx:key="index" 
              class="menstrual-bg menstrual-level-{{item.menstrualLevel || 0}}"
              wx:if="{{item.hasMenstrual}}"
              style="left: {{(index / (processedData.length - 1)) * 100}}%; width: {{100 / processedData.length}}%;">
        </view>
      </view>
      
      <!-- ä½“æ¸©çº¿å’Œç‚¹ -->
      <view class="temperature-layer">
        <!-- è¿æ¥çº¿ï¼ˆç®€åŒ–ï¼‰ -->
        <view class="temperature-line"></view>
        
        <!-- ä½“æ¸©ç‚¹ -->
        <view wx:for="{{processedData}}" wx:key="index" 
              wx:if="{{item.hasTemperature}}"
              class="temperature-point {{item.isHighTemp ? 'high-temp' : ''}}"
              style="left: {{(index / (processedData.length - 1)) * 100}}%; bottom: {{item.temperaturePercent}}%;"
              bindtap="onPointClick"
              data-index="{{index}}">
        </view>
      </view>
      
      <!-- åŒæˆ¿æ ‡è®° -->
      <view wx:if="{{viewMode === 'all'}}" class="intercourse-markers">
        <view wx:for="{{processedData}}" wx:key="index" 
              wx:if="{{item.hasIntercourse}}"
              class="intercourse-marker"
              style="left: {{(index / (processedData.length - 1)) * 100}}%;">
          <text class="marker-icon">ğŸ’•</text>
          <text wx:if="{{item.intercourseCount > 1}}" class="marker-count">{{item.intercourseCount}}</text>
        </view>
      </view>
    </view>
    
    <!-- Xè½´æ ‡ç­¾ -->
    <view class="x-axis">
      <view wx:for="{{processedData}}" wx:key="index" 
            wx:for-item="item" wx:for-index="idx"
            wx:if="{{displayIndexes.indexOf(idx) !== -1}}"
            class="x-label"
            style="left: {{(idx / (processedData.length - 1)) * 100}}%;">
        {{formatDateForDisplay(item.date)}}
      </view>
    </view>
  </view>
</view>