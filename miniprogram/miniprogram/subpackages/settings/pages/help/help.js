// pages/help/help.js - ä½¿ç”¨è¯´æ˜é¡µé¢
Page({
  data: {
    filteredSections: [], // è¿‡æ»¤åçš„ç« èŠ‚æ•°æ®
    helpSections: [
      {
        id: 'basic',
        title: 'åŸºç¡€åŠŸèƒ½',
        icon: 'ğŸ“±',
        items: [
          {
            title: 'é¦–é¡µæ¦‚è§ˆ',
            content: 'é¦–é¡µæ˜¾ç¤ºå½“å‰å‘¨æœŸçš„åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬å‘¨æœŸå¤©æ•°ã€å¹³å‡ä½“æ¸©ã€é¢„æµ‹æ’åµæ—¥ç­‰å…³é”®æ•°æ®ã€‚'
          },
          {
            title: 'å¿«æ·è®°å½•ï¼ˆæ–°ï¼‰',
            content: 'é¦–é¡µâ€œå¿«æ·è®°å½•â€æ”¯æŒè¯­éŸ³/æ–‡å­—ä¸€é”®è§£æä½“æ¸©ã€æ—¶é—´ã€ç»é‡ï¼ˆå«é¢œè‰²ï¼‰ã€åŒæˆ¿ï¼ˆå«æ˜¯å¦é¿å­•ï¼‰ï¼Œè§£æåå¯åœ¨è¡¨å•ä¸­ç¼–è¾‘ç¡®è®¤å†ä¿å­˜ï¼›æ”¯æŒç›¸å¯¹æ—¥æœŸï¼ˆæ˜¨å¤©/å‰å¤©ï¼‰ï¼Œä¸æ”¯æŒæœªæ¥æ—¥æœŸã€‚'
          },
          {
            title: 'æ•°æ®ç»Ÿè®¡',
            content: 'é¦–é¡µå¡ç‰‡å±•ç¤ºæœ¬å‘¨æœŸçš„æ•°æ®æ‘˜è¦ï¼Œå¸®åŠ©æ‚¨å¿«é€Ÿäº†è§£è®°å½•æƒ…å†µã€‚'
          }
        ]
      },
      {
        id: 'calendar',
        title: 'æ—¥å†åŠŸèƒ½',
        icon: 'ğŸ“…',
        items: [
          {
            title: 'æœˆè§†å›¾',
            content: 'æ—¥å†é¡µé¢ä»¥æœˆä¸ºå•ä½æ˜¾ç¤ºæ‰€æœ‰è®°å½•ï¼Œä¸åŒé¢œè‰²çš„æ ‡è®°ä»£è¡¨ä¸åŒç±»å‹çš„æ•°æ®ã€‚'
          },
          {
            title: 'æ•°æ®æ ‡è®°ä¸èƒŒæ™¯ï¼ˆæ›´æ–°ï¼‰',
            content: 'â€¢ çº¢è‰²åœ†ç‚¹ï¼šæœˆç»è®°å½•\nâ€¢ è“è‰²ï¼šåŒæˆ¿è®°å½•\nâ€¢ èƒŒæ™¯æµ…æ©™ï¼šæ˜“å­•æœŸ\nâ€¢ èƒŒæ™¯çº¢è‰²ï¼šæœ€ä½³å—å­•æœŸï¼ˆæ’åµæ—¥å‰2å¤©è‡³æ’åµæ—¥ï¼‰'
          },
          {
            title: 'æ—¥æœŸæ“ä½œ',
            content: 'ç‚¹å‡»ä»»æ„æ—¥æœŸå¯ä»¥æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯æˆ–æ·»åŠ /ç¼–è¾‘å½“æ—¥è®°å½•ã€‚'
          },
          {
            title: 'æœˆä»½åˆ‡æ¢',
            content: 'ä½¿ç”¨å·¦å³ç®­å¤´æˆ–æ»‘åŠ¨æ‰‹åŠ¿å¯ä»¥åˆ‡æ¢æŸ¥çœ‹ä¸åŒæœˆä»½çš„æ•°æ®ã€‚'
          }
        ]
      },
      {
        id: 'chart',
        title: 'å›¾è¡¨åˆ†æ',
        icon: 'ğŸ“Š',
        items: [
          {
            title: 'ä½“æ¸©æ›²çº¿',
            content: 'å›¾è¡¨é¡µé¢æ˜¾ç¤ºåŸºç¡€ä½“æ¸©çš„å˜åŒ–è¶‹åŠ¿ï¼Œå¸®åŠ©è¯†åˆ«æ’åµæœŸå’Œé»„ä½“æœŸã€‚'
          },
          {
            title: 'æ•°æ®æ ‡è®°ä¸èƒŒæ™¯ï¼ˆæ›´æ–°ï¼‰',
            content: 'â€¢ è“è‰²è¿çº¿ï¼šä½“æ¸©æ›²çº¿\nâ€¢ çº¢è‰²åœ†ç‚¹ï¼šæœˆç»è®°å½•\nâ€¢ ç´«è‰²åœ†ç‚¹ï¼šåŒæˆ¿è®°å½•\nâ€¢ èƒŒæ™¯æµ…æ©™ï¼šæ˜“å­•æœŸ\nâ€¢ èƒŒæ™¯çº¢è‰²ï¼šæœ€ä½³å—å­•æœŸ'
          },
          {
            title: 'æ—¥æœŸæ ¼å¼',
            content: 'å›¾è¡¨åº•éƒ¨æ˜¾ç¤ºæ—¥æœŸï¼Œæ ¼å¼ä¸ºMMDDï¼ˆå¦‚0728è¡¨ç¤º7æœˆ28æ—¥ï¼‰ã€‚'
          },
          {
            title: 'æ˜¾ç¤ºæ¨¡å¼',
            content: 'å¯ä»¥åˆ‡æ¢"å…¨éƒ¨æ•°æ®"å’Œ"ä»…ä½“æ¸©"ä¸¤ç§æ˜¾ç¤ºæ¨¡å¼ï¼Œæ»¡è¶³ä¸åŒåˆ†æéœ€æ±‚ã€‚'
          },
          {
            title: 'å‘¨æœŸåˆ‡æ¢',
            content: 'ä½¿ç”¨å·¦å³ç®­å¤´å¯ä»¥æŸ¥çœ‹ä¸åŒå‘¨æœŸçš„æ•°æ®ï¼Œæ–¹ä¾¿å¯¹æ¯”åˆ†æã€‚'
          }
        ]
      },
      {
        id: 'temperature',
        title: 'ä½“æ¸©è®°å½•',
        icon: 'ğŸŒ¡ï¸',
        items: [
          {
            title: 'æµ‹é‡æ—¶é—´',
            content: 'å»ºè®®æ¯å¤©æ—©æ™¨é†’æ¥åï¼Œåœ¨åŒä¸€æ—¶é—´æµ‹é‡åŸºç¡€ä½“æ¸©ï¼Œä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ã€‚'
          },
          {
            title: 'æµ‹é‡æ–¹æ³•',
            content: 'ä½¿ç”¨ä½“æ¸©è®¡æµ‹é‡å£è…”ã€è…‹ä¸‹æˆ–ç›´è‚ æ¸©åº¦ï¼Œæ¨èä½¿ç”¨æ•°å­—ä½“æ¸©è®¡è·å¾—ç²¾ç¡®è¯»æ•°ã€‚'
          },
          {
            title: 'æ•°æ®èŒƒå›´',
            content: 'æ­£å¸¸åŸºç¡€ä½“æ¸©èŒƒå›´ä¸º35.0Â°C-40.0Â°Cï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨éªŒè¯è¾“å…¥æ•°æ®çš„åˆç†æ€§ï¼›å¿«æ·è®°å½•æ”¯æŒä¸­æ–‡æ•°å­—ä¸æ—¶æ®µï¼ˆå¦‚â€œæ™šä¸Šåç‚¹â€ï¼‰ã€‚'
          },
          {
            title: 'è¶‹åŠ¿åˆ†æ',
            content: 'æ’åµåä½“æ¸©é€šå¸¸ä¼šä¸Šå‡0.3-0.5Â°Cï¼ŒæŒç»­åˆ°ä¸‹æ¬¡æœˆç»æ¥æ½®å‰ã€‚'
          }
        ]
      },
      {
        id: 'menstrual',
        title: 'æœˆç»è®°å½•',
        icon: 'ğŸ©¸',
        items: [
          {
            title: 'æµé‡ä¸é¢œè‰²ï¼ˆæ›´æ–°ï¼‰',
            content: 'æ”¯æŒè®°å½•æµé‡ï¼ˆæ— /å°‘é‡/ä¸­é‡/å¤§é‡ï¼‰ä¸é¢œè‰²ï¼ˆé²œçº¢/æš—çº¢/è¤è‰²/ç²‰è‰²ï¼‰ï¼Œé¢œè‰²ä»¥å°åœ†ç‚¹å±•ç¤ºã€‚'
          },
          {
            title: 'å‘¨æœŸè®¡ç®—',
            content: 'ç³»ç»Ÿä¼šè‡ªåŠ¨è®¡ç®—æœˆç»å‘¨æœŸé•¿åº¦ï¼Œå¹¶é¢„æµ‹ä¸‹æ¬¡æœˆç»å¼€å§‹æ—¶é—´ã€‚'
          },
          {
            title: 'é¢œè‰²æ ‡è®°',
            content: 'â€¢ æµ…çº¢è‰²ï¼šè½»åº¦æµé‡\nâ€¢ ä¸­çº¢è‰²ï¼šä¸­åº¦æµé‡\nâ€¢ æ·±çº¢è‰²ï¼šé‡åº¦æµé‡'
          },
          {
            title: 'å¥åº·æé†’',
            content: 'å¦‚æœæœˆç»å‘¨æœŸå¼‚å¸¸ï¼ˆè¿‡é•¿æˆ–è¿‡çŸ­ï¼‰ï¼Œå»ºè®®å’¨è¯¢åŒ»ç”Ÿã€‚'
          }
        ]
      },
      {
        id: 'intercourse',
        title: 'åŒæˆ¿è®°å½•',
        icon: 'ğŸ’•',
        items: [
          {
            title: 'æ—¶é—´è®°å½•',
            content: 'å¯ä»¥è®°å½•åŒæˆ¿çš„å…·ä½“æ—¶é—´ï¼Œå¸®åŠ©è®¡ç®—å—å­•æ¦‚ç‡ã€‚'
          },
          {
            title: 'å®‰å…¨æªæ–½',
            content: 'å¯ä»¥æ ‡è®°æ˜¯å¦é‡‡å–äº†å®‰å…¨æªæ–½ï¼Œä¾¿äºç”Ÿè‚²è®¡åˆ’ç®¡ç†ã€‚'
          },
          {
            title: 'é¢‘æ¬¡ç»Ÿè®¡',
            content: 'ç³»ç»Ÿä¼šç»Ÿè®¡æ¯ä¸ªå‘¨æœŸçš„åŒæˆ¿æ¬¡æ•°ï¼Œåœ¨å›¾è¡¨ä¸­ç”¨æ•°å­—æ ‡è®°å¤šæ¬¡è®°å½•ã€‚'
          },
          {
            title: 'æœ€ä½³æ—¶æœº',
            content: 'æ’åµæœŸå‰åæ˜¯å—å­•çš„æœ€ä½³æ—¶æœºï¼Œå¯ç»“åˆä½“æ¸©æ›²çº¿åˆ¤æ–­ã€‚'
          }
        ]
      },
      {
        id: 'settings',
        title: 'ä¸ªäººè®¾ç½®',
        icon: 'âš™ï¸',
        items: [
          {
            title: 'ä¸ªäººä¿¡æ¯ï¼ˆæ›´æ–°ï¼‰',
            content: 'å¯è®¾ç½®â€œå¹³å‡å‘¨æœŸé•¿åº¦â€å’Œâ€œé»„ä½“æœŸé•¿åº¦â€ã€‚ç³»ç»Ÿå°†æ®æ­¤ç»Ÿä¸€è®¡ç®—æ’åµä¸æ˜“å­•æœŸã€‚é»„ä½“æœŸé•¿åº¦ä¸å‘¨æœŸé•¿åº¦å­˜åœ¨å†²çªæ—¶ï¼Œé¡µé¢ä¼šç»™å‡ºè”åŠ¨å»ºè®®ã€‚'
          },
          {
            title: 'æé†’è®¾ç½®',
            content: 'å¯ä»¥è®¾ç½®ä½“æ¸©æµ‹é‡æé†’ã€æœˆç»é¢„æµ‹æé†’ç­‰ï¼Œé¿å…é—æ¼é‡è¦è®°å½•ã€‚'
          },
          {
            title: 'æ•°æ®ç®¡ç†',
            content: 'æ”¯æŒæ•°æ®å¯¼å‡ºä¸å¯¼å…¥ï¼›å¯¼å‡ºæ–‡ä»¶åŒ…å« schemaVersion å­—æ®µä»¥ä¾¿ç‰ˆæœ¬å…¼å®¹ã€‚'
          },
          {
            title: 'éšç§ä¿æŠ¤',
            content: 'æ‰€æœ‰æ•°æ®ä»…å­˜å‚¨åœ¨æ‚¨çš„è®¾å¤‡æœ¬åœ°ï¼Œç¡®ä¿ä¸ªäººéšç§å®‰å…¨ã€‚'
          }
        ]
      },
      {
        id: 'tips',
        title: 'ä½¿ç”¨æŠ€å·§',
        icon: 'ğŸ’¡',
        items: [
          {
            title: 'åšæŒè®°å½•',
            content: 'å»ºè®®æ¯å¤©åšæŒè®°å½•ä½“æ¸©ï¼Œè‡³å°‘è¿ç»­è®°å½•3ä¸ªæœˆç»å‘¨æœŸæ‰èƒ½è·å¾—å‡†ç¡®çš„æ’åµé¢„æµ‹ã€‚'
          },
          {
            title: 'æ•°æ®å®Œæ•´æ€§',
            content: 'å°½é‡è®°å½•å®Œæ•´çš„æ•°æ®ï¼ˆä½“æ¸©ã€æœˆç»ã€åŒæˆ¿ï¼‰ï¼Œè¿™æ ·åˆ†æç»“æœä¼šæ›´å‡†ç¡®ã€‚'
          },
          {
            title: 'å¼‚å¸¸æƒ…å†µ',
            content: 'å¦‚æœå‡ºç°å‘çƒ§ã€å¤±çœ ã€é¥®é…’ç­‰å½±å“ä½“æ¸©çš„æƒ…å†µï¼Œå¯ä»¥åœ¨å¤‡æ³¨ä¸­è¯´æ˜ã€‚'
          },
          {
            title: 'åŒ»ç”Ÿå’¨è¯¢',
            content: 'å¯ä»¥å°†å›¾è¡¨æ•°æ®æˆªå›¾æˆ–å¯¼å‡ºï¼Œåœ¨å°±åŒ»æ—¶æä¾›ç»™åŒ»ç”Ÿå‚è€ƒã€‚'
          },
          {
            title: 'å¤‡ä»½æ•°æ®',
            content: 'å®šæœŸå¤‡ä»½æ•°æ®ï¼Œé¿å…å› è®¾å¤‡é—®é¢˜å¯¼è‡´é‡è¦è®°å½•ä¸¢å¤±ã€‚'
          }
        ]
      }
    ],
    expandedSections: {},
    searchKeyword: ''
  },

  onLoad(query) {
    // æ”¯æŒä»¥éšç§æ”¿ç­–/è”ç³»æˆ‘ä»¬æ¨¡å¼æ˜¾ç¤º
    if (query && query.view === 'privacy') {
      const privacySections = [
        {
          id: 'privacy',
          title: 'éšç§æ”¿ç­–',
          icon: 'ğŸ”’',
          items: [
            { title: 'æœ¬åœ°å­˜å‚¨', content: 'æ‰€æœ‰æ•°æ®ä»…ä¿å­˜åœ¨æ‚¨çš„è®¾å¤‡ï¼Œä¸ä¼šä¸Šä¼ æœåŠ¡å™¨ã€‚' },
            { title: 'æƒé™ä½¿ç”¨', content: 'ä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨è¯»å†™å­˜å‚¨ã€å‰ªè´´æ¿ã€æ–‡ä»¶è®¿é—®ç­‰æœ¬åœ°æƒé™ã€‚' },
            { title: 'æ•°æ®å¯¼å‡º', content: 'å¯¼å‡ºæ–‡ä»¶ä»…ä¾›æ‚¨æœ¬äººä¿ç®¡ä¸åˆ†äº«ï¼Œè¯·å‹¿æ³„éœ²æ•æ„Ÿä¿¡æ¯ã€‚' },
            { title: 'æ•°æ®åˆ é™¤', content: 'å¯åœ¨è®¾ç½®â†’å±é™©æ“ä½œä¸­æ¸…ç©ºå…¨éƒ¨æ•°æ®ï¼Œæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚' },
            { title: 'å˜æ›´é€šçŸ¥', content: 'éšç§æ”¿ç­–å¦‚æœ‰å˜æ›´ï¼Œå°†åœ¨è®¾ç½®é¡µåŒæ­¥æ›´æ–°ç‰ˆæœ¬è¯´æ˜ã€‚' }
          ]
        }
      ];
      this.setData({
        helpSections: privacySections,
        filteredSections: privacySections,
        expandedSections: { privacy: true }
      });
      return;
    }
    if (query && query.view === 'contact') {
      const contactSections = [
        {
          id: 'contact',
          title: 'è”ç³»æˆ‘ä»¬',
          icon: 'ğŸ“®',
          items: [
            { title: 'å¾®ä¿¡å®˜æ–¹åé¦ˆï¼ˆæ¨èï¼‰', content: '1. åœ¨ä»»æ„é¡µé¢ï¼Œç‚¹å‡»å³ä¸Šè§’â€œ...â€èœå•\n2. é€‰æ‹©â€œåé¦ˆä¸æŠ•è¯‰â€è¿›å…¥åé¦ˆå…¥å£\n3. æŒ‰å¼•å¯¼æäº¤é—®é¢˜ï¼ˆå¯é™„æˆªå›¾/æè¿°/è”ç³»æ–¹å¼ï¼‰' },
            { title: 'é‚®ç®±è”ç³»', content: 'é‚®ç®±ï¼šchenyuanqi@outlook.com' },
            { title: 'æäº¤å»ºè®®çš„æœ€ä½³å®è·µ', content: 'è¯·å°½é‡æä¾›é—®é¢˜å‡ºç°çš„é¡µé¢ã€å¤ç°æ­¥éª¤ã€æˆªå›¾æˆ–å½•å±ã€è®¾å¤‡å‹å·ä¸ç³»ç»Ÿç‰ˆæœ¬ï¼Œä»¥ä¾¿å¿«é€Ÿå®šä½ä¸ä¿®å¤ã€‚' }
          ]
        }
      ];
      this.setData({
        helpSections: contactSections,
        filteredSections: contactSections,
        expandedSections: { contact: true }
      });
      return;
    }
    // é»˜è®¤å±•å¼€ç¬¬ä¸€ä¸ªéƒ¨åˆ†
    this.setData({
      'expandedSections.basic': true,
      filteredSections: this.data.helpSections
    });
  },

  /**
   * åˆ‡æ¢ç« èŠ‚å±•å¼€/æ”¶èµ·çŠ¶æ€
   */
  toggleSection(e) {
    const sectionId = e.currentTarget.dataset.id;
    const key = `expandedSections.${sectionId}`;
    const currentState = this.data.expandedSections[sectionId] || false;
    
    this.setData({
      [key]: !currentState
    });
  },

  /**
   * æœç´¢åŠŸèƒ½
   */
  onSearchInput(e) {
    const keyword = e.detail.value.toLowerCase();
    this.setData({
      searchKeyword: keyword
    });
    this.filterSections(keyword);
  },

  /**
   * æ¸…é™¤æœç´¢
   */
  clearSearch() {
    this.setData({
      searchKeyword: ''
    });
    this.filterSections('');
  },

  /**
   * è¿‡æ»¤ç« èŠ‚æ•°æ®
   */
  filterSections(keyword) {
    if (!keyword) {
      // æ²¡æœ‰æœç´¢å…³é”®è¯æ—¶æ˜¾ç¤ºæ‰€æœ‰ç« èŠ‚
      this.setData({
        filteredSections: this.data.helpSections
      });
      return;
    }

    // è¿‡æ»¤ç« èŠ‚å’Œé¡¹ç›®
    const filteredSections = this.data.helpSections.map(section => {
      // æ£€æŸ¥ç« èŠ‚æ ‡é¢˜æ˜¯å¦åŒ¹é…
      const sectionMatches = section.title.toLowerCase().includes(keyword);
      
      // è¿‡æ»¤åŒ¹é…çš„é¡¹ç›®
      const filteredItems = section.items.filter(item => 
        item.title.toLowerCase().includes(keyword) || 
        item.content.toLowerCase().includes(keyword)
      );
      
      // å¦‚æœç« èŠ‚æ ‡é¢˜åŒ¹é…æˆ–æœ‰åŒ¹é…çš„é¡¹ç›®ï¼Œåˆ™åŒ…å«æ­¤ç« èŠ‚
      if (sectionMatches || filteredItems.length > 0) {
        return {
          ...section,
          items: sectionMatches ? section.items : filteredItems
        };
      }
      
      return null;
    }).filter(section => section !== null);

    this.setData({
      filteredSections: filteredSections
    });
  },

  /**
   * å±•å¼€æ‰€æœ‰ç« èŠ‚
   */
  expandAll() {
    const expandedSections = {};
    this.data.filteredSections.forEach(section => {
      expandedSections[section.id] = true;
    });
    this.setData({ expandedSections });
  },

  /**
   * æ”¶èµ·æ‰€æœ‰ç« èŠ‚
   */
  collapseAll() {
    this.setData({ expandedSections: {} });
  },

  /**
   * åˆ†äº«ä½¿ç”¨è¯´æ˜
   */
  onShareAppMessage() {
    return {
      title: 'å¤‡å­•åŠ©æ‰‹ä½¿ç”¨è¯´æ˜',
      path: '/pages/help/help'
    };
  },

  /**
   * è¿”å›è®¾ç½®é¡µé¢
   */
  goBack() {
    wx.navigateBack();
  }
});