<!--pages/index/index.wxml-->
<view class="container">
  <!-- 加载状态 -->
  <view wx:if="{{isLoading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载中...</text>
  </view>

  <!-- 主要内容 -->
  <view wx:else>
    <!-- 日期头部 -->
    <view class="date-header">
      <text class="current-date">{{currentDate}}</text>
      <text class="day-of-week">{{currentDate}}</text>
    </view>

    <!-- 周期信息卡片 -->
    <view class="card cycle-card">
      <view class="card-header">
        <text class="card-title">周期信息</text>
      </view>
      <view class="card-body">
        <view class="cycle-info">
          <view class="cycle-item">
            <text class="cycle-label">周期第</text>
            <text class="cycle-value">{{cycleInfo.cycleDay}}</text>
            <text class="cycle-label">天</text>
          </view>
          <view class="cycle-item">
            <text class="cycle-label">当前阶段</text>
            <text class="cycle-value phase-{{cycleInfo.phase}}">
              {{cycleInfo.phase === 'menstrual' ? '月经期' : 
                cycleInfo.phase === 'follicular' ? '卵泡期' : 
                cycleInfo.phase === 'ovulation' ? '排卵期' : 
                cycleInfo.phase === 'luteal' ? '黄体期' : '未知'}}
            </text>
          </view>
        </view>
        <view class="predictions">
          <view class="prediction-item" wx:if="{{cycleInfo.nextPeriod}}">
            <text class="prediction-label">预测下次月经</text>
            <text class="prediction-value">{{cycleInfo.nextPeriod}}</text>
          </view>
          <view class="prediction-item" wx:if="{{cycleInfo.ovulationPrediction}}">
            <text class="prediction-label">预测排卵日</text>
            <text class="prediction-value">{{cycleInfo.ovulationPrediction}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 今日记录卡片 -->
    <view class="card today-card">
      <view class="card-header">
        <text class="card-title">今日记录</text>
      </view>
      <view class="card-body">
        <view class="today-records">
          <view class="record-item">
            <view class="record-icon temperature-icon"></view>
            <view class="record-content">
              <text class="record-label">体温</text>
              <text class="record-value">
                {{todayRecord && todayRecord.temperature ? todayRecord.temperature.temperature + '°C' : '未记录'}}
              </text>
            </view>
            <view class="record-action" bindtap="quickRecordTemperature">
              <text class="action-text">{{todayRecord && todayRecord.temperature ? '修改' : '记录'}}</text>
            </view>
          </view>
          
          <view class="record-item">
            <view class="record-icon menstrual-icon"></view>
            <view class="record-content">
              <text class="record-label">月经</text>
              <text class="record-value">
                {{todayRecord && todayRecord.menstrual ? 
                  (todayRecord.menstrual.flow === 'light' ? '少量' : 
                   todayRecord.menstrual.flow === 'medium' ? '中等' : 
                   todayRecord.menstrual.flow === 'heavy' ? '大量' : '未知') : '未记录'}}
              </text>
            </view>
            <view class="record-action" bindtap="quickRecordMenstrual">
              <text class="action-text">{{todayRecord && todayRecord.menstrual ? '修改' : '记录'}}</text>
            </view>
          </view>
          
          <view class="record-item">
            <view class="record-icon intercourse-icon"></view>
            <view class="record-content">
              <text class="record-label">同房</text>
              <text class="record-value">
                {{todayRecord && todayRecord.intercourse && todayRecord.intercourse.length > 0 ? 
                  todayRecord.intercourse.length + '次' : '未记录'}}
              </text>
            </view>
            <view class="record-action" bindtap="quickRecordIntercourse">
              <text class="action-text">{{todayRecord && todayRecord.intercourse && todayRecord.intercourse.length > 0 ? '修改' : '记录'}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 快速统计卡片 -->
    <view class="card stats-card">
      <view class="card-header">
        <text class="card-title">最近30天统计</text>
      </view>
      <view class="card-body">
        <view class="stats-grid">
          <view class="stat-item">
            <text class="stat-value">{{quickStats.temperatureRecords}}</text>
            <text class="stat-label">体温记录</text>
          </view>
          <view class="stat-item">
            <text class="stat-value">{{quickStats.menstrualDays}}</text>
            <text class="stat-label">月经天数</text>
          </view>
          <view class="stat-item">
            <text class="stat-value">{{quickStats.intercourseCount}}</text>
            <text class="stat-label">同房次数</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 快速导航 -->
    <view class="quick-nav">
      <view class="nav-item" bindtap="viewChart">
        <view class="nav-icon chart-icon"></view>
        <text class="nav-label">查看图表</text>
      </view>
      <view class="nav-item" bindtap="viewCalendar">
        <view class="nav-icon calendar-icon"></view>
        <text class="nav-label">查看日历</text>
      </view>
    </view>
  </view>
</view>