<!--pages/record/record.wxml-->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <loading wx:if="{{isLoading}}" text="æ­£åœ¨ä¿å­˜..." />
  
  <!-- é¡¶éƒ¨æ ‡é¢˜å’Œæ—¥æœŸ -->
  <view class="header">
    <view class="title">æ•°æ®è®°å½•</view>
    <view class="date">{{selectedDate}}</view>
  </view>
  
  <!-- è®°å½•ç±»å‹åˆ‡æ¢ -->
  <view class="record-types">
    <view class="type-item {{recordType === 'temperature' ? 'active' : ''}}" 
          bindtap="onRecordTypeChange" data-type="temperature">
      <view class="type-icon">ğŸŒ¡ï¸</view>
      <view class="type-label">ä½“æ¸©</view>
    </view>
    <view class="type-item {{recordType === 'menstrual' ? 'active' : ''}}" 
          bindtap="onRecordTypeChange" data-type="menstrual">
      <view class="type-icon">ğŸ©¸</view>
      <view class="type-label">ç»é‡</view>
    </view>
    <view class="type-item {{recordType === 'intercourse' ? 'active' : ''}}" 
          bindtap="onRecordTypeChange" data-type="intercourse">
      <view class="type-icon">ğŸ’•</view>
      <view class="type-label">åŒæˆ¿</view>
    </view>
  </view>
  
  <!-- ä½“æ¸©è®°å½•è¡¨å• -->
  <view class="record-form" wx:if="{{recordType === 'temperature'}}">
    <view class="form-title">åŸºç¡€ä½“æ¸©è®°å½•</view>
    
    <!-- ä½“æ¸©è¾“å…¥ -->
    <view class="form-item">
      <view class="label">ä½“æ¸© (Â°C)</view>
      <view class="input-wrapper">
        <view class="temperature-display" bindtap="showTemperatureInput">
          <text class="value">{{temperatureValue || 'ç‚¹å‡»è¾“å…¥'}}</text>
          <text class="unit">Â°C</text>
        </view>
      </view>
    </view>
    
    <!-- æµ‹é‡æ—¶é—´ -->
    <view class="form-item">
      <view class="label">æµ‹é‡æ—¶é—´</view>
      <picker mode="time" value="{{temperatureTime}}" bindchange="onTemperatureTimeChange">
        <view class="picker-display">{{temperatureTime}}</view>
      </picker>
    </view>
    
    <!-- å¤‡æ³¨ -->
    <view class="form-item">
      <view class="label">å¤‡æ³¨ (å¯é€‰)</view>
      <textarea class="note-input" 
                placeholder="ç—‡çŠ¶ã€ç¡çœ è´¨é‡ç­‰å¤‡æ³¨" 
                value="{{temperatureNote}}"
                bindinput="onTemperatureNoteInput"
                maxlength="100"
                show-confirm-bar="{{false}}"></textarea>
    </view>
    
    <!-- æ“ä½œæŒ‰é’® -->
    <view class="form-actions">
      <button class="save-btn" bindtap="saveTemperatureRecord" disabled="{{isLoading}}">
        ä¿å­˜ä½“æ¸©è®°å½•
      </button>
      <button wx:if="{{todayRecord && todayRecord.temperature}}" 
              class="delete-btn" 
              bindtap="deleteRecord" 
              data-type="temperature">
        åˆ é™¤è®°å½•
      </button>
    </view>
  </view>
  
  <!-- ç»é‡è®°å½•è¡¨å• -->
  <view class="record-form" wx:if="{{recordType === 'menstrual'}}">
    <view class="form-title">æœˆç»ç»é‡è®°å½•</view>
    
    <!-- ç»é‡é€‰æ‹©æ»‘æ¡ -->
    <view class="form-item">
      <view class="label">ç»é‡</view>
      <slider title="ç»é‡é€‰æ‹©"
              value="{{menstrualFlow}}"
              options="{{flowOptions}}"
              bindchange="onFlowSliderChange"
              bindconfirm="onFlowSliderChange"></slider>
    </view>
    
    <!-- ç»æœŸå¼€å§‹/ç»“æŸæ ‡è®° -->
    <view class="form-item">
      <view class="label">ç»æœŸæ ‡è®°</view>
      <view class="period-markers">
        <view class="marker-item">
          <switch checked="{{isStartPeriod}}" bindchange="onPeriodStartChange"></switch>
          <text>ç»æœŸå¼€å§‹</text>
        </view>
        <view class="marker-item">
          <switch checked="{{isEndPeriod}}" bindchange="onPeriodEndChange"></switch>
          <text>ç»æœŸç»“æŸ</text>
        </view>
      </view>
    </view>
    
    <!-- å¤‡æ³¨ -->
    <view class="form-item">
      <view class="label">å¤‡æ³¨ (å¯é€‰)</view>
      <textarea class="note-input" 
                placeholder="ç—›ç»ç¨‹åº¦ã€é¢œè‰²ç­‰å¤‡æ³¨" 
                value="{{menstrualNote}}"
                bindinput="onMenstrualNoteInput"
                maxlength="100"
                show-confirm-bar="{{false}}"></textarea>
    </view>
    
    <!-- æ“ä½œæŒ‰é’® -->
    <view class="form-actions">
      <button class="save-btn" bindtap="saveMenstrualRecord" disabled="{{isLoading}}">
        ä¿å­˜ç»é‡è®°å½•
      </button>
      <button wx:if="{{todayRecord && todayRecord.menstrual}}" 
              class="delete-btn" 
              bindtap="deleteRecord" 
              data-type="menstrual">
        åˆ é™¤è®°å½•
      </button>
    </view>
  </view>
  
  <!-- åŒæˆ¿è®°å½•è¡¨å• -->
  <view class="record-form" wx:if="{{recordType === 'intercourse'}}">
    <view class="form-title">åŒæˆ¿è®°å½•</view>
    
    <!-- æ—¶é—´é€‰æ‹© -->
    <view class="form-item">
      <view class="label">æ—¶é—´</view>
      <picker mode="time" value="{{intercourseTime}}" bindchange="onIntercourseTimeChange">
        <view class="picker-display">{{intercourseTime}}</view>
      </picker>
    </view>
    
    <!-- é¿å­•æªæ–½ -->
    <view class="form-item">
      <view class="label">é¿å­•æªæ–½</view>
      <view class="protection-item">
        <switch checked="{{hasProtection}}" bindchange="onProtectionChange"></switch>
        <text>é‡‡å–äº†é¿å­•æªæ–½</text>
      </view>
    </view>
    
    <!-- å¤‡æ³¨ -->
    <view class="form-item">
      <view class="label">å¤‡æ³¨ (å¯é€‰)</view>
      <textarea class="note-input" 
                placeholder="å…¶ä»–å¤‡æ³¨ä¿¡æ¯" 
                value="{{intercourseNote}}"
                bindinput="onIntercourseNoteInput"
                maxlength="100"
                show-confirm-bar="{{false}}"></textarea>
    </view>
    
    <!-- æ“ä½œæŒ‰é’® -->
    <view class="form-actions">
      <button class="save-btn" bindtap="saveIntercourseRecord" disabled="{{isLoading}}">
        ä¿å­˜åŒæˆ¿è®°å½•
      </button>
      <button wx:if="{{todayRecord && todayRecord.intercourse && todayRecord.intercourse.length > 0}}" 
              class="delete-btn" 
              bindtap="deleteRecord" 
              data-type="intercourse">
        åˆ é™¤è®°å½•
      </button>
    </view>
  </view>
  
  <!-- ä»Šæ—¥è®°å½•é¢„è§ˆ -->
  <view class="today-records" wx:if="{{todayRecord}}">
    <view class="records-title">ä»Šæ—¥å·²æœ‰è®°å½•</view>
    
    <!-- ä½“æ¸©è®°å½•é¢„è§ˆ -->
    <view class="record-preview" wx:if="{{todayRecord.temperature}}">
      <view class="preview-icon">ğŸŒ¡ï¸</view>
      <view class="preview-content">
        <view class="preview-label">ä½“æ¸©</view>
        <view class="preview-value">{{todayRecord.temperature.temperature}}Â°C ({{todayRecord.temperature.time}})</view>
      </view>
    </view>
    
    <!-- ç»é‡è®°å½•é¢„è§ˆ -->
    <view class="record-preview" wx:if="{{todayRecord.menstrual}}">
      <view class="preview-icon">ğŸ©¸</view>
      <view class="preview-content">
        <view class="preview-label">ç»é‡</view>
        <view class="preview-value">
          {{todayRecord.menstrual.flow === 'light' ? 'å°‘é‡' : 
            todayRecord.menstrual.flow === 'medium' ? 'ä¸­ç­‰' : 
            todayRecord.menstrual.flow === 'heavy' ? 'è¾ƒå¤š' : 'æ— '}}
          <text wx:if="{{todayRecord.menstrual.isStart}}" class="period-tag">å¼€å§‹</text>
          <text wx:if="{{todayRecord.menstrual.isEnd}}" class="period-tag">ç»“æŸ</text>
        </view>
      </view>
    </view>
    
    <!-- åŒæˆ¿è®°å½•é¢„è§ˆ -->
    <view class="record-preview" wx:if="{{todayRecord.intercourse && todayRecord.intercourse.length > 0}}">
      <view class="preview-icon">ğŸ’•</view>
      <view class="preview-content">
        <view class="preview-label">åŒæˆ¿</view>
        <view class="preview-value">
          {{todayRecord.intercourse.length}}æ¬¡ 
          <text wx:if="{{todayRecord.intercourse[0].protection}}" class="protection-tag">æœ‰ä¿æŠ¤</text>
        </view>
      </view>
    </view>
  </view>
</view>

<!-- ä½“æ¸©è¾“å…¥é”®ç›˜ -->
<keyboard 
  visible="{{showTemperatureKeyboard}}"
  title="è¯·è¾“å…¥ä½“æ¸©"
  value="{{temperatureValue}}"
  maxLength="5"
  minValue="35.0"
  maxValue="42.0"
  decimalPlaces="1"
  bindconfirm="onTemperatureConfirm"
  bindcancel="onTemperatureCancel">
</keyboard>