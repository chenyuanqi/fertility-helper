<!--pages/chart/chart.wxml-->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{isLoading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½å›¾è¡¨ä¸­...</text>
  </view>

  <!-- ä¸»è¦å†…å®¹ -->
  <view wx:else>
    <!-- å‘¨æœŸä¿¡æ¯å¤´éƒ¨ -->
    <view class="chart-header">
      <view class="cycle-info-header">
        <view class="cycle-title">å½“å‰å‘¨æœŸ - ç¬¬{{cycleStats.cycleDay}}å¤©</view>
        <view class="cycle-navigation">
          <button class="nav-btn" bindtap="onPreviousCycle">â€¹</button>
          <button class="nav-btn" bindtap="onNextCycle">â€º</button>
        </view>
      </view>
      
      <view class="cycle-stats">
        <view class="stat-item">
          <view class="stat-value">{{cycleStats.cycleDay}}</view>
          <view class="stat-label">å‘¨æœŸå¤©æ•°</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{cycleStats.averageTemp || '--'}}</view>
          <view class="stat-label">å¹³å‡ä½“æ¸©</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{cycleStats.predictedOvulation || '--'}}</view>
          <view class="stat-label">é¢„è®¡æ’åµ</view>
        </view>
      </view>
    </view>

    <!-- å›¾è¡¨å®¹å™¨ -->
    <view class="chart-container">
      <view class="chart-controls">
        <view class="chart-title">ä¸‰åˆä¸€å›¾è¡¨</view>
        <view class="chart-actions">
          <button class="chart-btn {{viewMode === 'all' ? 'active' : ''}}" 
                  bindtap="onViewModeChange" data-mode="all">å…¨éƒ¨</button>
          <button class="chart-btn {{viewMode === 'temperature' ? 'active' : ''}}" 
                  bindtap="onViewModeChange" data-mode="temperature">ä½“æ¸©</button>
        </view>
      </view>
      
      <!-- å›¾è¡¨ç»„ä»¶ -->
      <chart 
        chart-data="{{chartData}}"
        width="{{350}}"
        height="{{300}}"
        view-mode="{{viewMode}}"
        bind:pointClick="onPointClick">
      </chart>
    </view>

    <!-- å›¾ä¾‹è¯´æ˜ -->
    <view class="chart-legend">
      <view class="legend-title">å›¾ä¾‹è¯´æ˜</view>
      <view class="legend-items">
        <view class="legend-item">
          <view class="legend-icon temperature"></view>
          <text>åŸºç¡€ä½“æ¸©</text>
        </view>
        <view class="legend-item" wx:if="{{viewMode === 'all'}}">
          <view class="legend-icon menstrual"></view>
          <text>æœˆç»èƒŒæ™¯</text>
        </view>
        <view class="legend-item" wx:if="{{viewMode === 'all'}}">
          <text class="legend-emoji">ğŸ’•</text>
          <text>åŒæˆ¿è®°å½•</text>
        </view>
        <view class="legend-item">
          <view class="legend-icon high-temp"></view>
          <text>é«˜æ¸©æœŸ</text>
        </view>
      </view>
    </view>

    <!-- æ•°æ®ç»Ÿè®¡å¡ç‰‡ -->
    <view class="data-summary">
      <view class="summary-title">æ•°æ®ç»Ÿè®¡</view>
      <view class="summary-content">
        <view class="summary-item">
          <text class="summary-label">ä½“æ¸©è®°å½•</text>
          <text class="summary-value">{{cycleStats.temperatureCount}}å¤©</text>
        </view>
        <view class="summary-item">
          <text class="summary-label">ç»æœŸå¤©æ•°</text>
          <text class="summary-value">{{cycleStats.menstrualDays}}å¤©</text>
        </view>
        <view class="summary-item">
          <text class="summary-label">åŒæˆ¿æ¬¡æ•°</text>
          <text class="summary-value">{{cycleStats.intercourseCount}}æ¬¡</text>
        </view>
      </view>
    </view>

    <!-- å¿«é€Ÿæ“ä½œ -->
    <view class="quick-actions">
      <button class="action-btn primary" bindtap="goToRecord">
        <text class="btn-icon">ğŸ“</text>
        <text class="btn-text">è®°å½•æ•°æ®</text>
      </button>
    </view>
  </view>
</view>