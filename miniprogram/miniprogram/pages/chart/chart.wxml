<!--pages/chart/chart.wxml-->
<view class="chart-page">
  <!-- å‘¨æœŸä¿¡æ¯å¤´éƒ¨ -->
  <view class="chart-header">
    <view class="cycle-nav">
      <button class="nav-btn" bindtap="prevCycle">
        <text class="nav-icon">â€¹</text>
      </button>
      <view class="cycle-info">
        <text class="cycle-title">ç¬¬{{cycleStats.cycleDay}}å¤©</text>
        <text class="cycle-subtitle">{{dateRange.start}} - {{dateRange.end}}</text>
      </view>
      <button class="nav-btn" bindtap="nextCycle">
        <text class="nav-icon">â€º</text>
      </button>
    </view>
    
    <view class="cycle-stats">
      <view class="stat-item">
        <text class="stat-value">{{cycleStats.averageTemp}}Â°C</text>
        <text class="stat-label">å¹³å‡ä½“æ¸©</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{cycleStats.predictedOvulation}}</text>
        <text class="stat-label">é¢„è®¡æ’åµ</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{cycleStats.temperatureCount}}</text>
        <text class="stat-label">ä½“æ¸©è®°å½•</text>
      </view>
    </view>
  </view>

  <!-- å›¾è¡¨å®¹å™¨ -->
  <view class="chart-container">
    <view class="chart-controls">
      <view class="view-mode-tabs">
        <button class="tab-btn {{viewMode === 'all' ? 'active' : ''}}" 
                bindtap="switchViewMode" data-mode="all">
          å…¨éƒ¨
        </button>
        <button class="tab-btn {{viewMode === 'temperature' ? 'active' : ''}}" 
                bindtap="switchViewMode" data-mode="temperature">
          ä½“æ¸©
        </button>
      </view>
      
      <view class="chart-actions">
        <button class="chart-btn {{isZoomed ? 'active' : ''}}" bindtap="toggleZoom">
          <text class="btn-icon">ğŸ”</text>
        </button>
      </view>
    </view>
    
    <view class="chart-title">
      <text>ä¸‰åˆä¸€å›¾è¡¨</text>
    </view>
    
    <!-- ä¸‰åˆä¸€å›¾è¡¨ -->
    <view class="chart-mock" id="chartArea">
      <chart 
        chartData="{{chartData}}"
        width="{{chartWidth}}"
        height="300"
        viewMode="{{viewMode}}"
        bind:pointClick="onPointClick">
      </chart>
    </view>
  </view>

  <!-- å›¾ä¾‹è¯´æ˜ -->
  <view class="chart-legend">
    <view class="legend-title">å›¾ä¾‹è¯´æ˜</view>
    <view class="legend-items">
      <view class="legend-item">
        <view class="legend-icon temperature"></view>
        <text>ä½“æ¸©</text>
      </view>
      <view class="legend-item">
        <view class="legend-icon menstruation"></view>
        <text>æœˆç»</text>
      </view>
      <view class="legend-item">
        <view class="legend-icon intimacy"></view>
        <text>åŒæˆ¿</text>
      </view>
      <view class="legend-item">
        <view class="legend-icon ovulation"></view>
        <text>æ’åµ</text>
      </view>
      <view class="legend-item">
        <view class="legend-icon coverline"></view>
        <text>è¦†ç›–çº¿</text>
      </view>
    </view>
  </view>

  <!-- æ•°æ®è¯¦æƒ… -->
  <view class="data-details" wx:if="{{selectedPointData}}">
    <view class="details-header">
      <text class="selected-date">{{selectedPointData.dateDisplay}}</text>
      <button class="close-btn" bindtap="closeDetails">Ã—</button>
    </view>
    <view class="details-content">
      <view class="detail-item">
        <text class="detail-value">{{selectedPointData.temperature}}</text>
        <text class="detail-label">ä½“æ¸©</text>
      </view>
      <view class="detail-item">
        <text class="detail-value">{{selectedPointData.menstruation}}</text>
        <text class="detail-label">æœˆç»</text>
      </view>
      <view class="detail-item">
        <text class="detail-value">{{selectedPointData.intercourse}}</text>
        <text class="detail-label">åŒæˆ¿</text>
      </view>
    </view>
  </view>
</view>