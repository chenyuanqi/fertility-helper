<!--pages/chart/chart.wxml-->
<view class="chart-page">
  <!-- 周期信息头部 -->
  <view class="chart-header">
    <view class="cycle-nav">
      <button class="nav-btn" bindtap="prevCycle">
        <text class="nav-icon">‹</text>
      </button>
      <view class="cycle-info">
        <text class="cycle-title">第{{cycleStats.cycleDay}}天</text>
        <text class="cycle-subtitle">{{dateRange.start}} - {{dateRange.end}}</text>
      </view>
      <button class="nav-btn" bindtap="nextCycle">
        <text class="nav-icon">›</text>
      </button>
    </view>
    
    <view class="cycle-stats">
      <view class="stat-item">
        <text class="stat-value">{{cycleStats.averageTemp}}°C</text>
        <text class="stat-label">平均体温</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{cycleStats.predictedOvulation}}</text>
        <text class="stat-label">预计排卵</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{cycleStats.temperatureCount}}</text>
        <text class="stat-label">体温记录</text>
      </view>
    </view>
  </view>

  <!-- 图表容器 -->
  <view class="chart-container">
    <view class="chart-controls">
      <view class="view-mode-tabs">
        <button class="tab-btn {{viewMode === 'all' ? 'active' : ''}}" 
                bindtap="switchViewMode" data-mode="all">
          全部
        </button>
        <button class="tab-btn {{viewMode === 'temperature' ? 'active' : ''}}" 
                bindtap="switchViewMode" data-mode="temperature">
          体温
        </button>
      </view>
      
      <view class="chart-actions">
        <button class="chart-btn {{isZoomed ? 'active' : ''}}" bindtap="toggleZoom">
          <text class="btn-icon">🔍</text>
        </button>
      </view>
    </view>
    
    <view class="chart-title">
      <text>三合一图表</text>
    </view>
    
    <!-- 三合一图表 -->
    <view class="chart-mock" id="chartArea">
      <chart 
        chartData="{{chartData}}"
        width="{{chartWidth}}"
        height="300"
        viewMode="{{viewMode}}"
        bind:pointClick="onPointClick">
      </chart>
    </view>
  </view>

  <!-- 图例说明 -->
  <view class="chart-legend">
    <view class="legend-title">图例说明</view>
    <view class="legend-items">
      <view class="legend-item">
        <view class="legend-icon temperature"></view>
        <text>体温</text>
      </view>
      <view class="legend-item">
        <view class="legend-icon menstruation"></view>
        <text>月经</text>
      </view>
      <view class="legend-item">
        <view class="legend-icon intimacy"></view>
        <text>同房</text>
      </view>
      <view class="legend-item">
        <view class="legend-icon ovulation"></view>
        <text>排卵</text>
      </view>
      <view class="legend-item">
        <view class="legend-icon coverline"></view>
        <text>覆盖线</text>
      </view>
    </view>
  </view>

  <!-- 数据详情 -->
  <view class="data-details" wx:if="{{selectedPointData}}">
    <view class="details-header">
      <text class="selected-date">{{selectedPointData.dateDisplay}}</text>
      <button class="close-btn" bindtap="closeDetails">×</button>
    </view>
    <view class="details-content">
      <view class="detail-item">
        <text class="detail-value">{{selectedPointData.temperature}}</text>
        <text class="detail-label">体温</text>
      </view>
      <view class="detail-item">
        <text class="detail-value">{{selectedPointData.menstruation}}</text>
        <text class="detail-label">月经</text>
      </view>
      <view class="detail-item">
        <text class="detail-value">{{selectedPointData.intercourse}}</text>
        <text class="detail-label">同房</text>
      </view>
    </view>
  </view>
</view>