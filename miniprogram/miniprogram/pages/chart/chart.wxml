<!--pages/chart/chart.wxml-->
<view class="chart-page">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{isLoading}}" class="loading">
    <text>åŠ è½½å›¾è¡¨æ•°æ®ä¸­...</text>
  </view>

  <!-- ä¸»è¦å†…å®¹ -->
  <view wx:else>
    <!-- å‘¨æœŸä¿¡æ¯å¤´éƒ¨ -->
    <view class="chart-header">
      <view class="cycle-title">
        <text>å½“å‰å‘¨æœŸ</text>
      </view>
      
      <view class="cycle-day-row">
        <button class="nav-btn" bindtap="onPreviousCycle">
          <text class="nav-icon">â€¹</text>
        </button>
        <view class="cycle-day-container">
          <text class="cycle-day">ç¬¬</text>
          <text class="cycle-day-number">{{cycleStats.cycleDay || 0}}</text>
          <text class="cycle-day">å¤©</text>
        </view>
        <button class="nav-btn" bindtap="onNextCycle">
          <text class="nav-icon">â€º</text>
        </button>
      </view>
      
      <view class="cycle-date-row">
        <text class="cycle-date-range">{{dateRange.start}} è‡³ {{dateRange.end}}</text>
      </view>
      
      <view class="cycle-stats">
        <view class="stat-item">
          <text class="stat-value">{{cycleStats.averageTemp || '0.0'}}Â°C</text>
          <text class="stat-label">å¹³å‡ä½“æ¸©</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{cycleStats.predictedOvulation || '--'}}</text>
          <text class="stat-label">é¢„è®¡æ’åµ</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{cycleStats.temperatureRecords || 0}}</text>
          <text class="stat-label">ä½“æ¸©è®°å½•</text>
        </view>
      </view>
    </view>

    <!-- å›¾è¡¨å®¹å™¨ -->
    <view class="chart-container">
      <view class="chart-controls">
        <view class="view-mode-tabs">
          <button class="tab-btn {{viewMode === 'all' ? 'active' : ''}}" 
                  bindtap="onViewModeChange" data-mode="all">
            ğŸ“Š å…¨éƒ¨æ•°æ®
          </button>
          <button class="tab-btn {{viewMode === 'temperature' ? 'active' : ''}}" 
                  bindtap="onViewModeChange" data-mode="temperature">
            ğŸŒ¡ï¸ ä»…ä½“æ¸©
          </button>
        </view>
        
        <view class="chart-actions">
          <button class="chart-btn {{isZoomed ? 'active' : ''}}" bindtap="onZoomToggle">
            <text class="btn-icon">{{isZoomed ? 'ğŸ”' : 'ğŸ”'}}</text>
          </button>
        </view>
      </view>
      
      <view class="chart-title">
        <text>ğŸ“ˆ å¤‡å­•æ•°æ®å›¾è¡¨</text>
      </view>
      
      <!-- ä¸‰åˆä¸€å›¾è¡¨ -->
      <view class="chart-mock" id="chartArea" bindtap="onChartTap">
        <chart 
          chartData="{{chartData}}"
          width="{{chartWidth}}"
          height="300"
          viewMode="{{viewMode}}"
          bind:pointClick="onPointClick">
        </chart>
        <view class="chart-hint">
          <text class="chart-hint-icon">ğŸ”</text>
          <text>ç‚¹å‡»æ”¾å¤§æŸ¥çœ‹</text>
        </view>
      </view>
    </view>

    <!-- å›¾ä¾‹è¯´æ˜ -->
    <view class="chart-legend">
      <view class="legend-title">ğŸ“‹ å›¾ä¾‹è¯´æ˜</view>
      <view class="legend-items">
        <view class="legend-item">
          <view class="legend-icon temperature"></view>
          <text>åŸºç¡€ä½“æ¸©</text>
        </view>
        <view class="legend-item">
          <view class="legend-icon menstruation"></view>
          <text>æœˆç»è®°å½•</text>
        </view>
        <view class="legend-item">
          <view class="legend-icon intimacy"></view>
          <text>åŒæˆ¿è®°å½•</text>
        </view>
        <view class="legend-item">
          <view class="legend-icon ovulation"></view>
          <text>æ’åµé¢„æµ‹</text>
        </view>
        <view class="legend-item">
          <view class="legend-icon coverline"></view>
          <text>è¦†ç›–çº¿</text>
        </view>
      </view>
    </view>

    <!-- æ•°æ®è¯¦æƒ…å¼¹çª— -->
    <view class="data-details" wx:if="{{selectedPointData}}">
      <view class="details-header">
        <text class="selected-date">ğŸ“… {{selectedPointData.dateDisplay}}</text>
        <button class="close-btn" bindtap="closeDetails">âœ•</button>
      </view>
      <view class="details-content">
        <view class="detail-item">
          <text class="detail-value">ğŸŒ¡ï¸ {{selectedPointData.temperature}}</text>
          <text class="detail-label">åŸºç¡€ä½“æ¸©</text>
        </view>
        <view class="detail-item">
          <text class="detail-value">ğŸ©¸ {{selectedPointData.menstruation}}</text>
          <text class="detail-label">æœˆç»æƒ…å†µ</text>
        </view>
        <view class="detail-item">
          <text class="detail-value">ğŸ’• {{selectedPointData.intercourse}}</text>
          <text class="detail-label">åŒæˆ¿è®°å½•</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å…¨å±å›¾è¡¨æ¨¡æ€æ¡† -->
  <view class="chart-fullscreen" wx:if="{{showFullscreenChart}}">
    <view class="chart-fullscreen-header">
      <text class="chart-fullscreen-title">è¯¦ç»†å›¾è¡¨</text>
      <button class="chart-fullscreen-close" bindtap="closeFullscreenChart">å…³é—­</button>
    </view>
    <view class="chart-fullscreen-content">
      <scroll-view class="chart-scroll-container" scroll-x="true" enhanced="true" show-scrollbar="false">
        <view class="chart-expanded">
          <chart 
            chartData="{{chartData}}"
            width="1200"
            height="600"
            viewMode="{{viewMode}}"
            bind:pointClick="onPointClick">
          </chart>
        </view>
      </scroll-view>
      <view class="chart-fullscreen-tips">
        <text>ğŸ‘† å·¦å³æ»‘åŠ¨æŸ¥çœ‹æ›´å¤šæ•°æ®</text>
      </view>
      <view class="chart-fullscreen-description">
        <text>æ­¤å›¾è¡¨å±•ç¤ºäº†æ‚¨çš„åŸºç¡€ä½“æ¸©å˜åŒ–ã€æœˆç»å‘¨æœŸå’ŒåŒæˆ¿è®°å½•ï¼Œå¸®åŠ©æ‚¨æ›´å¥½åœ°äº†è§£è‡ªå·±çš„ç”Ÿè‚²å¥åº·çŠ¶å†µã€‚</text>
      </view>
    </view>
  </view>
</view>