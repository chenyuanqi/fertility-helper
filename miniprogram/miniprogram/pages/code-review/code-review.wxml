<!--ä»£ç å®¡æŸ¥é¡µé¢æ¨¡æ¿-->
<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="header">
    <view class="title">ä»£ç å®¡æŸ¥</view>
    <view class="subtitle">ç¡®ä¿ä»£ç è´¨é‡ï¼Œä¸ºå‘å¸ƒåšå¥½å‡†å¤‡</view>
  </view>

  <!-- å®¡æŸ¥çŠ¶æ€å¡ç‰‡ -->
  <view class="review-status">
    <!-- å‡†å¤‡çŠ¶æ€ -->
    <view wx:if="{{reviewStatus === 'ready'}}" class="status-ready">
      <view class="status-icon">ğŸ”</view>
      <view class="status-text">å‡†å¤‡å¼€å§‹ä»£ç å®¡æŸ¥</view>
      <view class="current-step">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹å…¨é¢çš„ä»£ç è´¨é‡æ£€æŸ¥</view>
      <button class="btn btn-primary" bindtap="startReview">å¼€å§‹å®¡æŸ¥</button>
    </view>

    <!-- è¿è¡ŒçŠ¶æ€ -->
    <view wx:elif="{{reviewStatus === 'running'}}" class="status-running">
      <view class="status-icon">âš™ï¸</view>
      <view class="status-text">æ­£åœ¨æ‰§è¡Œä»£ç å®¡æŸ¥</view>
      <view class="current-step">{{currentStep}}</view>
      
      <view class="progress-container">
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{progress}}%"></view>
        </view>
        <view class="progress-text">{{progress}}% å®Œæˆ</view>
      </view>
    </view>

    <!-- å®ŒæˆçŠ¶æ€ -->
    <view wx:elif="{{reviewStatus === 'completed'}}" class="status-completed">
      <view class="status-icon">âœ…</view>
      <view class="status-text">ä»£ç å®¡æŸ¥å®Œæˆ</view>
      <view class="current-step">å®¡æŸ¥ç»“æœå·²ç”Ÿæˆï¼Œè¯·æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Š</view>
    </view>

    <!-- å¤±è´¥çŠ¶æ€ -->
    <view wx:elif="{{reviewStatus === 'failed'}}" class="status-failed">
      <view class="status-icon">âŒ</view>
      <view class="status-text">å®¡æŸ¥å¤±è´¥</view>
      <view class="current-step">å®¡æŸ¥è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œè¯·é‡è¯•</view>
      <button class="btn btn-warning" bindtap="restartReview">é‡æ–°å®¡æŸ¥</button>
    </view>
  </view>

  <!-- å®¡æŸ¥ç»“æœ -->
  <view wx:if="{{reviewStatus === 'completed' && reviewResults}}" class="review-results fade-in">
    <view class="results-header">
      <view class="results-title">å®¡æŸ¥æŠ¥å‘Š</view>
      <view class="share-btn" bindtap="shareReport">åˆ†äº«</view>
    </view>

    <!-- æ€»ä½“è¯„åˆ† -->
    <view class="score-display">
      <view class="score-circle" style="background: {{getScoreColor(summary.score)}}">
        <view class="score-text">{{summary.score}}</view>
      </view>
      <view class="grade-text">{{summary.grade}}çº§ - {{getGradeDescription(summary.grade)}}</view>
      <view class="release-recommendation">{{summary.releaseRecommendation}}</view>
    </view>

    <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
    <view class="stats-grid">
      <view class="stat-card">
        <view class="stat-number">{{summary.totalFiles}}</view>
        <view class="stat-label">æ€»æ–‡ä»¶æ•°</view>
      </view>
      <view class="stat-card">
        <view class="stat-number">{{summary.totalLines}}</view>
        <view class="stat-label">ä»£ç è¡Œæ•°</view>
      </view>
      <view class="stat-card">
        <view class="stat-number">{{summary.totalIssues}}</view>
        <view class="stat-label">å‘ç°é—®é¢˜</view>
      </view>
      <view class="stat-card">
        <view class="stat-number">{{recommendations.length}}</view>
        <view class="stat-label">æ”¹è¿›å»ºè®®</view>
      </view>
    </view>

    <!-- è¯¦ç»†ä¿¡æ¯æ ‡ç­¾é¡µ -->
    <view class="tab-container">
      <view class="tab-header">
        <view class="tab-item {{activeTab === 'overview' ? 'active' : ''}}" 
              data-tab="overview" bindtap="switchTab">æ¦‚è§ˆ</view>
        <view class="tab-item {{activeTab === 'issues' ? 'active' : ''}}" 
              data-tab="issues" bindtap="switchTab">é—®é¢˜</view>
        <view class="tab-item {{activeTab === 'recommendations' ? 'active' : ''}}" 
              data-tab="recommendations" bindtap="switchTab">å»ºè®®</view>
        <view class="tab-item {{activeTab === 'files' ? 'active' : ''}}" 
              data-tab="files" bindtap="switchTab">æ–‡ä»¶</view>
      </view>

      <view class="tab-content">
        <!-- æ¦‚è§ˆæ ‡ç­¾é¡µ -->
        <view wx:if="{{activeTab === 'overview'}}">
          <view class="stats-grid">
            <view class="stat-card">
              <view class="stat-number" style="color: #F44336">{{statistics.severityStats['ä¸¥é‡'] || 0}}</view>
              <view class="stat-label">ä¸¥é‡é—®é¢˜</view>
            </view>
            <view class="stat-card">
              <view class="stat-number" style="color: #FF9800">{{statistics.severityStats['é‡è¦'] || 0}}</view>
              <view class="stat-label">é‡è¦é—®é¢˜</view>
            </view>
            <view class="stat-card">
              <view class="stat-number" style="color: #2196F3">{{statistics.severityStats['ä¸€èˆ¬'] || 0}}</view>
              <view class="stat-label">ä¸€èˆ¬é—®é¢˜</view>
            </view>
            <view class="stat-card">
              <view class="stat-number" style="color: #4CAF50">{{statistics.severityStats['å»ºè®®'] || 0}}</view>
              <view class="stat-label">å»ºè®®ä¼˜åŒ–</view>
            </view>
          </view>
        </view>

        <!-- é—®é¢˜æ ‡ç­¾é¡µ -->
        <view wx:elif="{{activeTab === 'issues'}}">
          <!-- é—®é¢˜ç­›é€‰ -->
          <view class="issue-filters">
            <view class="filter-btn {{selectedSeverity === 'all' ? 'active' : ''}}" 
                  data-severity="all" bindtap="filterIssues">å…¨éƒ¨</view>
            <view class="filter-btn {{selectedSeverity === 'ä¸¥é‡' ? 'active' : ''}}" 
                  data-severity="ä¸¥é‡" bindtap="filterIssues">ä¸¥é‡</view>
            <view class="filter-btn {{selectedSeverity === 'é‡è¦' ? 'active' : ''}}" 
                  data-severity="é‡è¦" bindtap="filterIssues">é‡è¦</view>
            <view class="filter-btn {{selectedSeverity === 'ä¸€èˆ¬' ? 'active' : ''}}" 
                  data-severity="ä¸€èˆ¬" bindtap="filterIssues">ä¸€èˆ¬</view>
            <view class="filter-btn {{selectedSeverity === 'å»ºè®®' ? 'active' : ''}}" 
                  data-severity="å»ºè®®" bindtap="filterIssues">å»ºè®®</view>
          </view>

          <!-- é—®é¢˜åˆ—è¡¨ -->
          <view class="issue-list">
            <view wx:for="{{filteredIssues}}" wx:key="index" 
                  class="issue-item severity-{{item.severity}}"
                  data-index="{{index}}" bindtap="viewIssueDetail">
              <view class="issue-header">
                <view class="issue-severity severity-{{item.severity}}">{{item.severity}}</view>
                <view class="issue-category">{{item.category}}</view>
              </view>
              <view class="issue-description">{{item.description}}</view>
              <view class="issue-file">{{item.file}}{{item.line ? ':' + item.line : ''}}</view>
            </view>
            
            <view wx:if="{{filteredIssues.length === 0}}" class="empty-state">
              <view class="empty-icon">ğŸ‰</view>
              <view class="empty-text">æ²¡æœ‰å‘ç°{{selectedSeverity === 'all' ? '' : selectedSeverity}}é—®é¢˜</view>
            </view>
          </view>
        </view>

        <!-- å»ºè®®æ ‡ç­¾é¡µ -->
        <view wx:elif="{{activeTab === 'recommendations'}}">
          <view class="recommendation-list">
            <view wx:for="{{recommendations}}" wx:key="index" class="recommendation-item">
              <view class="recommendation-header">
                <view class="recommendation-priority">{{item.priority}}</view>
                <view class="recommendation-category">{{item.category}}</view>
              </view>
              <view class="recommendation-description">{{item.description}}</view>
              <view class="recommendation-action">å»ºè®®: {{item.action}}</view>
            </view>
            
            <view wx:if="{{recommendations.length === 0}}" class="empty-state">
              <view class="empty-icon">ğŸ‘</view>
              <view class="empty-text">æš‚æ— æ”¹è¿›å»ºè®®</view>
            </view>
          </view>
        </view>

        <!-- æ–‡ä»¶æ ‡ç­¾é¡µ -->
        <view wx:elif="{{activeTab === 'files'}}">
          <view class="file-stats">
            <view class="file-stat-item">
              <view class="file-stat-label">JavaScriptæ–‡ä»¶</view>
              <view class="file-stat-value">{{statistics.jsFiles}}</view>
            </view>
            <view class="file-stat-item">
              <view class="file-stat-label">æ¨¡æ¿æ–‡ä»¶</view>
              <view class="file-stat-value">{{statistics.wxmlFiles}}</view>
            </view>
            <view class="file-stat-item">
              <view class="file-stat-label">æ ·å¼æ–‡ä»¶</view>
              <view class="file-stat-value">{{statistics.wxssFiles}}</view>
            </view>
            <view class="file-stat-item">
              <view class="file-stat-label">é…ç½®æ–‡ä»¶</view>
              <view class="file-stat-value">{{statistics.jsonFiles}}</view>
            </view>
            <view class="file-stat-item">
              <view class="file-stat-label">æ€»ä»£ç è¡Œæ•°</view>
              <view class="file-stat-value">{{statistics.totalLines}}</view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-buttons">
      <button class="btn btn-secondary" bindtap="restartReview">é‡æ–°å®¡æŸ¥</button>
    </view>
  </view>
</view>